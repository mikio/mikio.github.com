---
layout: default
title: Benighted on the Ben.
excerpt: An unplanned bivouac on Ben Nevis.
---

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">はじめに</h2>
<div class="outline-text-2" id="text-1">

<p>日経Linux2010年６月号の特集を真似てCENTOSをLVMのミラーで構築したのはいいが
ある日ディスクサイズをみたらもうディスクフルになってる！
</p>


<pre class="src src-sh">[miki@localhost ~]$ df -h
Filesystem          &#12469;&#12452;&#12474;  &#20351;&#29992;  &#27531;&#12426; &#20351;&#29992;% &#12510;&#12454;&#12531;&#12488;&#20301;&#32622;
/dev/md0              3.9G  2.3G  1.5G  61% /
/dev/mapper/vg00-home
                      3.9G  3.7G     0 100% /home
/dev/mapper/vg00-var  3.9G  3.7G  836K 100% /var
/dev/mapper/vg00-mysql
                      3.9G  137M  3.6G   4% /var/lib/mysql
tmpfs                1006M     0 1006M   0% /dev/shm
</pre>

<p>
ディスクは１６０GB確保したはずなのになぜ？
dfの結果をよく見ると、合計で１６Gしかない。。。なぜだ？
ちなみにRAID1のディスクミラーをつかって160GBのディスク２台で運用している。
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">LVM</h2>
<div class="outline-text-2" id="text-2">

<p>LVMよくわからないのでググる。
下記を見る限り、LVMは作成されていて、容量が足りないわけだから
既存のLVを増やさばいいということがわかった。
</p>


<pre class="src src-sh">[miki@localhost ~]$ df -h
Filesystem          &#12469;&#12452;&#12474;  &#20351;&#29992;  &#27531;&#12426; &#20351;&#29992;% &#12510;&#12454;&#12531;&#12488;&#20301;&#32622;
/dev/md0              3.9G  2.3G  1.5G  61% /
/dev/mapper/vg00-home
                      3.9G  3.7G     0 100% /home
/dev/mapper/vg00-var  3.9G  3.7G  836K 100% /var
/dev/mapper/vg00-mysql
                      3.9G  137M  3.6G   4% /var/lib/mysql
tmpfs                1006M     0 1006M   0% /dev/shm
</pre>


<p>
pgdisplayが見つからない。
</p>


<pre class="src src-sh">[miki@localhost ~]$ which pvdisplay
/usr/bin/which: no pvdisplay<span class="org-keyword"> in</span> (/usr/kerberos/bin:/usr/local/jdk1.6.0_24//bin:/usr/local/bin:/bin:/usr/bin:/home/miki/bin)
</pre>


<p>
もしかして個別にインストールが必要なのかとか、rootじゃないと使えないコマンドなのかとかで
わざわざVGAの小型モニタかってrootで直接作業したけど見つからず＾＾。
</p>
<p>
その後、下記コマンドで見つかった。
</p>


<pre class="src src-sh">[miki@localhost ~]$ whereis pvdisplay
pvdisplay: /usr/sbin/pvdisplay /usr/share/man/man8/pvdisplay.8.gz
</pre>

<p>
アホ過ぎる。。。
</p>



<pre class="src src-sh">[miki@localhost ~]$ sudo /usr/sbin/pvdisplay
  --- Physical volume ---
  PV Name               /dev/md1
  VG Name               vg00
  PV Size               290.10 GB / not usable 5.00 MB
  Allocatable           yes
  PE Size (KByte)       32768
  Total PE              9283
  Free PE               8835
  Allocated PE          448
  PV UUID               p6XFrn-nSDe-mcgf-VcVm-o5ME-VWzW-1RoLh3
</pre>

<p>
物理ボリュームが290GBあるということか。
</p>

<p>
PV(PhisicalVolume): 物理ディスク
VG(VlumeGroup)    : 物理ディスクを束ねた物(PVをまとめて大きな論理ハードディスクとみなす）
</p>
<p>
LV(LogicalVolume) : 論理ディスク
</p>

<p>
論理ボリュームの/homeのディスクサイズを増やす
</p>


<pre class="src src-sh">$ sudo /usr/sbin/lvextend -L +80G /dev/vg00/home
</pre>

<p>
増やしたらFilesysteを拡張する。本来はunmountする必要があるが、ext3はオンラインで拡張できるらいしい。
</p>


<pre class="src src-sh">$ sudo /sbin/resize2fs /dev/vg00/home
</pre>


<p>
続いてvar下を増やす。
</p>


<pre class="src src-sh">sudo /usr/sbin/lvextend -L +30G /dev/vg00/var
sudo /sbin/resize2fs /dev/vg00/var
</pre>


<p>
さらにmysql下も増やす。
</p>


<pre class="src src-sh">sudo /usr/sbin/lvextend -L +100G /dev/vg00/mysql
sudo /sbin/resize2fs /dev/vg00/var
</pre>



<p>
これでとりあえずひと通り増やせた。
/var配下は共有ディレクトリをふくんでるので今後、さらに増やす必要があるかも。
逆にmysqlはwikipediaのデータを置かない限り100GBもいらないかもな。
</p>

</div>
</div>
