<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Windows版のSwank-Clojureでclojure-jack-inが実行できない。</title>
    <link rel="stylesheet" type="text/less" href="../../../style/less/o-blog.less">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../../../style/js/less-1.3.0.min.js" type="text/javascript"></script>
    <script src="../../../style/js/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-modal.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-transition.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-dropdown.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-collapse.js" type="text/javascript"></script>
    <script src="../../../style/js/prettify.js" type="text/javascript"></script>
    <script src="../../../style/js/o-blog.linenumber.js" type="text/javascript"></script>
    <script src="../../../style/js/o-blog-fix.js" type="text/javascript"></script>
    <script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
  </head>
  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
	<div class="container">
	  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
	  <a class="brand" href="../../../index.html">ざる魂</a>
	  <div class="nav-collapse collapse">
	    <ul>
<li><a href="#"><i>icon-file icon-white</i> article</a>
<ul>
<li><a href="../../../article/2012/08/08_compojure-slime-2.html">Compojure + SLIMEを試す その2</a>
</li>
<li><a href="../../../article/2012/08/03_compojure-slime-1.html">Compojure + SLIMEを試す その1</a>
</li>
<li><a href="../../../article/2012/06/28_.html">デジジョンテーブルの作成</a>
</li>
<li><a href="../../../article/2012/06/26_variable-binding-depth-exceeds-max-specpdl-size.html">「Variable binding depth exceeds max-specpdl-size」というメッセージがでて何も操作できなくなった。</a>
</li>
<li><a href="../../../article/2012/06/11_o-blogfork.html">o-blogのfork元から最新を取り込む</a>

</li>
</ul>

</li>
<li><a href="../../../tags/index.html"><i>icon-tags icon-white</i> Tags</a>

</li>
<li><a href="../../../archives.html"><i>icon-list icon-white</i> Archives</a>

</li>
<li><a href="../../../index.xml">RSS</a>
</li>
</ul>



	  </div>
	</div>
      </div>
    </div>
    <div class="subnav subnav-fixed visible-desktop">
      <div class="container">
	<ul class="breadcrumb">
  <li><a href="../../../index.html">Home</a> <span class="divider">/</span></li>
  <li><a href="../../../article/index.html">article</a> <span class="divider">/</span></li><li><a href="../../../article/2012/index.html">2012</a> <span class="divider">/</span></li><li><a href="../../../article/2012/04/index.html">04</a> <span class="divider">/</span></li><li>Windows版のSwank-Clojureでclojure-jack-inが実行できない。</li>
  </ul>

      </div>
    </div>
    <div id="page" class="container">

  <header class="article-header">

    <div class="well">
      <div class="row">
	<div class="date span1">
	  <div class=" date-d">06</div>
	  <div class=" date-m"><a href="../../../article/2012/04/index.html">4</a></div>
	  <div class=" date-y"><a href="../../../article/2012/index.html">2012</a>
	  </div>
	</div>
	<div class="span1">
	  <div class="qr-code">
  <img src="http://chart.apis.google.com/chart?chs=50x50&cht=qr&chld=|0&chl=http%3A%2F%2Fmikio.github.com%2F%2Farticle%2F2012%2F04%2F06_windowsswank-clojureclojure-jack-in.html"
       alt="qr-code" />
</div>

	</div>
	<h1 class="offset2" style="font-size: 250%">Windows版のSwank-Clojureでclojure-jack-inが実行できない。</h1>
      </div>
      <nav>
	<ul class="pager">
	  <li class="previous"><a href="../../../article/2012/04/05_clojureslimerepl.html"><i class="icon-chevron-left"></i>&nbsp;ClojureのSLIMEのREPLバッファに色がつかない</a></li><li class="next" style="text-align: right;"><a href="../../../article/2012/04/09_skk.html">SKKはサジェストと相性がいい!&nbsp;<i class="icon-chevron-right"></i></a></li>
	</ul>
      </nav>
    </div>

  </header>
  <div class="article-content">
    <p>
最近のclojure-swankには、emacsから直接swank-serverを起動するための「clojure-jack-in」とemacsコマンドがある。
これを使うと、わざわざ別の端末でswank-serverを起動せずとも、直接裏でサーバーが起動してくれるのでとっても便利である。
のはずなのだが、、、WindowsXPだと例によってうまく起動できないので(Linux版だと問題なし)、ちょっと修正しなくちゃいけない。
ここではその過程をメモしておく。
</p>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">結論</h3>
<div class="outline-text-3" id="text-1">


<p>
結論を示すと下記のパッチでうまくいく。
</p>


<pre class="src src-sh">$ diff -u $<span style="color: #eedd82;">HOME</span>/bin/lein.bat.orig $<span style="color: #eedd82;">HOME</span>/bin/lein.bat
--- /cygdrive/c/Users/mikio/bin/lein.bat.orig  2012-04-05 12:59:29.352024000 +0900
+++ /cygdrive/c/Users/mikio/bin/lein.bat       2012-04-06 13:32:27.537281600 +0900
@@ -23,7 +23,7 @@

 <span style="color: #ffff00;">if</span> <span style="color: #ffa07a;">"x%LEIN_HOME%"</span> == <span style="color: #ffa07a;">"x"</span> (
     <span style="color: #ffff00;">if</span> exist <span style="color: #ffa07a;">"%CD%\.lein"</span> (
-        if /I NOT %CD%==%USERPROFILE% echo Running<span style="color: #ffff00;"> in</span> bundled mode.
+        if /I NOT <span style="color: #ffa07a;">"%CD%"</span>==<span style="color: #ffa07a;">"%USERPROFILE%"</span> echo Running<span style="color: #ffff00;"> in</span> bundled mode.
         <span style="color: #b0c4de;">set</span> <span style="color: #eedd82;">LEIN_HOME</span>=%CD%<span style="color: #ffa07a;">\.</span>lein
     ) <span style="color: #ffff00;">else</span> (
         <span style="color: #b0c4de;">set</span> <span style="color: #eedd82;">LEIN_HOME</span>=%USERPROFILE%<span style="color: #ffa07a;">\.</span>lein
</pre>


</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">経過</h3>
<div class="outline-text-3" id="text-2">

<p>まずlein.bat自体がうまく動くのかためす。
dos窓でlein.batを実行すると下記のエラーがでてしまう。   
</p>


<pre class="src src-sh">C:\Documents and Settings\mikio&gt;lein
and &#12398;&#20351;&#12356;&#26041;&#12364;&#35492;&#12387;&#12390;&#12356;&#12414;&#12377;&#12290;
</pre>

<p>
。。。エラーメッセージが不親切すぎて何していいかわかりません。
dosのバッチファイルを読むのは数年ぶりですがとりあえず
</p>
<p>
デバッグ情報を出すために「echo off」を解除する
</p>


<pre class="src src-sh">::@echo off

<span style="color: #b0c4de;">set</span> <span style="color: #eedd82;">JAVA_OPTS</span>=-Dswank.encoding=utf-8-unix
</pre>

<p>
すると下記で停止してることがわかった。
</p>


<pre class="src src-sh">C:\Documents and Settings\mikio&gt;if <span style="color: #ffa07a;">""</span> NEQ <span style="color: #ffa07a;">""</span> cd <span style="color: #ffa07a;">""</span>
and &#12398;&#20351;&#12356;&#26041;&#12364;&#35492;&#12387;&#12390;&#12356;&#12414;&#12377;&#12290;
C:\Documents and Settings\mikio&gt;        if /I NOT C:\Documents and Settings\<span style="color: #eedd82;">mikio</span>==C:\Documents and Settings\mikio echo Running<span style="color: #ffff00;"> in</span> bundled mode.
</pre>


<p>
IF文の条件式で与えられた変数が空白を含むために
条件式が文法エラーになっているようだ。
そこで、その条件式の変数部分をダブルクオーテーションで括ってみた。
</p>
<p>
この状態でlein.batを実行してみたところ通常どおり実行できた。
</p>


<pre class="src src-sh">C:\Documents and Settings\mikio&gt;lein.bat
Leiningen is a tool for working with Clojure projects.

Several tasks are available:
classpath   Print the classpath of the current project.
clean       Remove compiled class files and jars from project.
compile     Compile Clojure source into .class files.
deploy      Build jar and deploy to remote repository.
deps        Download :dependencies and put them<span style="color: #ffff00;"> in</span> :library-path.
help        Display a list of tasks or help for a given task.
install     Install current project or download specified project.
interactive Enter an interactive task shell. Aliased to <span style="color: #ffa07a;">"int"</span>.
jack-in     Jack<span style="color: #ffff00;"> in</span> to a Clojure SLIME session from Emacs.
jar         Package up all the project<span style="color: #ffa07a;">'s files into a jar file.</span>
<span style="color: #ffa07a;">javac       Compile Java source files.</span>
<span style="color: #ffa07a;">new         Create a new project skeleton.</span>
<span style="color: #ffa07a;">noir        Create and manage noir projects.</span>
<span style="color: #ffa07a;">plugin      Manage user-level plugins.</span>
<span style="color: #ffa07a;">pom         Write a pom.xml file to disk for Maven interop.</span>
<span style="color: #ffa07a;">repl        Start a repl session either with the current project or standalone.</span>
<span style="color: #ffa07a;">retest      Run only the test namespaces which failed last time around.</span>
<span style="color: #ffa07a;">run         Run the project'</span>s -main function.
search      Search remote maven repositories for matching jars.
swank       Launch swank server for Emacs to connect.
<span style="color: #b0c4de;">test</span>        Run the project<span style="color: #ffa07a;">'s tests.</span>
<span style="color: #ffa07a;">test!       Run a project'</span>s tests after cleaning and fetching dependencies.
trampoline  Run a task without nesting the project<span style="color: #ffa07a;">'s JVM inside Leiningen'</span>s.
uberjar     Package up the project files and all dependencies into a jar file.
upgrade     Upgrade Leiningen to the latest stable release.
version     Print version for Leiningen and the current JVM.

Run lein help $<span style="color: #eedd82;">TASK</span> for details.
See also: readme, tutorial, copying, sample, deploying and news.

C:\Documents and Settings\mikio&gt;
</pre>


<p>
この修正が完了した時点で「M-x clojure-jack-in」を実行してみたところ
無事SLIMEのREPLバッファが表示されたよ!
</p>
<p>
わざわざ別窓を開いてswank-serverを起動しなくて済むのでかなり快適になったよ!
</p>
</div>
</div>

  </div>
  
  <footer class="well article-footer">
    Posted on <time datetime=\"2012-04-06T22:53:00Z\"> 金曜日 4月, 06 2012 at 22:53:00</time>.
    <nav class="tag-cloud">
      <h1><i class="icon-tags"></i> related tags</h1>
      <ul>
	<li><a href="../../../tags/clojure.html">clojure</a></li><li><a href="../../../tags/dos.html">dos</a></li><li><a href="../../../tags/slime.html">slime</a></li>
      </ul>
    </nav>
  </footer>
  <div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'mikiokunblog'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

      </div>
      <div id="footer">
	<div class="container">
	  <div class="row">
	    <section class="span3">
	      <h1>About</h1>
	      <p>
<img src="http://ja.gravatar.com/userimage/34519202/9f2afee0916f884e17ba9de3a4d09e70.jpg"  alt="http://ja.gravatar.com/userimage/34519202/9f2afee0916f884e17ba9de3a4d09e70.jpg" />
</p>



<pre class="src src-clojure">(mikio_kun
 {<span style="color: #7fffd4;">:&#33288;&#21619;</span> <span style="color: #ffa07a;">"ubuntu/emacs/clojure"</span>
  <span style="color: #7fffd4;">:&#19968;&#35328;</span> <span style="color: #ffa07a;">"Clojurian&#12395;&#12394;&#12426;&#12383;&#12356;"</span>})
</pre>



	    </section>
	    <nav id="links" class="span3">
	      <h1>Links</h1>
	      <ul>
		<ul>
<li><a href="../../../index.html"><i>icon-home icon-white</i> Home</a>

</li>
<li><a href="Lisp error in nil: (error ob:post-htmlfile accessing a non-ob:post)"><i>icon-file icon-white</i> Tips</a>

</li>
<li><a href="../../../tags/index.html"><i>icon-tags icon-white</i> Tags</a>

</li>
<li><a href="../../../archives.html"><i>icon-list icon-white</i> Archives</a>

</li>
<li><a href="../../../index.xml">RSS</a>
</li>
</ul>



	      </ul>
	    </nav>
	    <nav id="archives" class="span3">
	      <h1>Archives</h1>
	      <ul>
		<li><a href="../../../article/2012/08/08_compojure-slime-2.html">Compojure + SLIMEを試す その2</a></li> <li><a href="../../../article/2012/08/03_compojure-slime-1.html">Compojure + SLIMEを試す その1</a></li> <li><a href="../../../article/2012/06/28_.html">デジジョンテーブルの作成</a></li> <li><a href="../../../article/2012/06/26_variable-binding-depth-exceeds-max-specpdl-size.html">「Variable binding depth exceeds max-specpdl-size」というメッセージがでて何も操作できなくなった。</a></li> <li><a href="../../../article/2012/06/11_o-blogfork.html">o-blogのfork元から最新を取り込む</a></li> <li><a href="../../../article/2012/06/02_javap.html">javapコマンドを使ってみた。</a></li> <li><a href="../../../article/2012/05/23_android.html">Android開発環境の準備</a></li> <li><a href="../../../article/2012/05/21_java.html">Javaでカンマ区切りの数字を出力する。</a></li> <li><a href="../../../article/2012/05/18_galaxynoteroot.html">GalaxyNote(国際版)をroot化</a></li> <li><a href="../../../article/2012/05/12_gimp.html">gimpで画像サイズを変更する</a></li> 
	      </ul>
	    </nav>
	    <nav class="tags span3">
	      <h1>Tags</h1>
	      <ul>
  <li style="font-size: 108.00%;"><a href="../../../tags/android.html">android</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/apache.html">apache</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/blog.html">blog</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/centos.html">centos</a></li> <li style="font-size: 220.00%;"><a href="../../../tags/clojure.html">clojure</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/clojurescript.html">clojurescript</a></li> <li style="font-size: 94.00%;"><a href="../../../tags/commonlisp.html">commonlisp</a></li> <li style="font-size: 94.00%;"><a href="../../../tags/compojure.html">compojure</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/css.html">css</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/dos.html">dos</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/dropbox.html">dropbox</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/e2wm.html">e2wm</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/eclipse.html">eclipse</a></li> <li style="font-size: 178.00%;"><a href="../../../tags/emacs.html">emacs</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/gamedev.html">gamedev</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/gimp.html">gimp</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/git.html">git</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/github.html">github</a></li> <li style="font-size: 136.00%;"><a href="../../../tags/hamari.html">hamari</a></li> <li style="font-size: 94.00%;"><a href="../../../tags/hiccup.html">hiccup</a></li> <li style="font-size: 94.00%;"><a href="../../../tags/java.html">java</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/javascript.html">javascript</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/less.html">less</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/linux.html">linux</a></li> <li style="font-size: 122.00%;"><a href="../../../tags/lisp.html">lisp</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/lvm.html">lvm</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/mew.html">mew</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/notes.html">notes</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/o.html">o</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/playframework.html">playframework</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/problem.html">problem</a></li> <li style="font-size: 94.00%;"><a href="../../../tags/ring.html">ring</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/rooted.html">rooted</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/sbcl.html">sbcl</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/scheme.html">scheme</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/sdic.html">sdic</a></li> <li style="font-size: 94.00%;"><a href="../../../tags/skk.html">skk</a></li> <li style="font-size: 150.00%;"><a href="../../../tags/slime.html">slime</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/sudo.html">sudo</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/swank.html">swank</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/test.html">test</a></li> <li style="font-size: 94.00%;"><a href="../../../tags/ubuntu.html">ubuntu</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/windows.html">windows</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/windowsxp.html">windowsxp</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/zenbook.html">zenbook</a></li> 
</ul>

	    </nav>
	  </div>
	</div>
	<div class="copyright" style="text-align: center;">
	  <p>
Copyright © 2008-2012 <a href="http://twitter.com/mikio_kun">mikio</a>
</p>
	  <p>Powered by <a href="https://github.com/renard/o-blog">o-blog</a>.</p>
	</div>
      </div>
</body>
</html>

