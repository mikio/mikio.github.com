<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Windows版のSwank-Clojureでclojure-jack-inが実行できない。</title>
    <link rel="stylesheet" type="text/less" href="../../../style/less/o-blog.less"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="generator" content="o-blog version 1.2"/>
    <script src="../../../style/js/less-1.3.0.min.js" type="text/javascript"></script>
    <script src="../../../style/js/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-modal.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-transition.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-dropdown.js" type="text/javascript"></script>
    <script src="../../../style/bootstrap/js/bootstrap-collapse.js" type="text/javascript"></script>
    <script src="../../../style/js/prettify.js" type="text/javascript"></script>
    <script src="../../../style/js/o-blog.linenumber.js" type="text/javascript"></script>
    <script src="../../../style/js/o-blog-fix.js" type="text/javascript"></script>
    
  </head>
  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
	<div class="container">
	  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
	  <a class="brand" href="../../../index.html">ざる魂</a>
	  <div class="nav-collapse collapse">
	    <ul>
<li><a href="#"><i>icon-file icon-white</i> article</a>
<ul>
<li><a href="Lisp error in nil: (wrong-type-argument arrayp nil)">Lisp error in nil: (wrong-type-argument arrayp nil)</a>
</li>
<li><a href="Lisp error in nil: (wrong-type-argument arrayp nil)">Lisp error in nil: (wrong-type-argument arrayp nil)</a>
</li>
<li><a href="Lisp error in nil: (wrong-type-argument arrayp nil)">Lisp error in nil: (wrong-type-argument arrayp nil)</a>
</li>
<li><a href="Lisp error in nil: (wrong-type-argument arrayp nil)">Lisp error in nil: (wrong-type-argument arrayp nil)</a>
</li>
<li><a href="Lisp error in nil: (wrong-type-argument arrayp nil)">Lisp error in nil: (wrong-type-argument arrayp nil)</a>

</li>
</ul>

</li>
<li><a href="../../../tags/index.html"><i>icon-tags icon-white</i> Tags</a>

</li>
<li><a href="../../../archives.html"><i>icon-list icon-white</i> Archives</a>

</li>
<li><a href="../../../index.xml">RSS</a>
</li>
</ul>




	  </div>
	</div>
      </div>
    </div>
    <div class="subnav subnav-fixed visible-desktop">
      <div class="container">
	<ul class="breadcrumb">
  <li><a href="../../../index.html">Home</a> <span class="divider">/</span></li>
  <li><a href="../../../article/index.html">Article</a> <span class="divider">/</span></li><li><a href="../../../article/2012/index.html">2012</a> <span class="divider">/</span></li><li><a href="../../../article/2012/04/index.html">04</a> <span class="divider">/</span></li><li>Windows版のSwank-Clojureでclojure-jack-inが実行できない。</li>
  </ul>

      </div>
    </div>
    <div id="page" class="container">

  <header class="article-header">

    <div class="well">
      <div class="row">
	<div class="date span1">
	  <div class=" date-d">06</div>
	  <div class=" date-m"><a href="../../../article/2012/04/index.html"> 4月</a></div>
	  <div class=" date-y"><a href="../../../article/2012/index.html">2012</a>
	  </div>
	</div>
	<div class="span1">
	  <div class="qr-code">
  <img src="http://chart.apis.google.com/chart?chs=50x50&cht=qr&chld=|0&chl=http%3a%2f%2fmikio.github.com%2f%2farticle%2f2012%2f04%2f06_windowsswank-clojureclojure-jack-in.html"
       alt="qr-code" />
</div>

	</div>
	<h1 class="offset2" style="font-size: 250%">Windows版のSwank-Clojureでclojure-jack-inが実行できない。</h1>
      </div>
      <nav>
	<ul class="pager">
	  <li class="previous"><a href="../../../article/2012/04/05_clojureslimerepl.html"><i class="icon-chevron-left"></i>&nbsp;ClojureのSLIMEのREPLバッファに色がつかない</a></li><li class="next" style="text-align: right;"><a href="../../../article/2012/04/09_skk.html">SKKはサジェストと相性がいい!&nbsp;<i class="icon-chevron-right"></i></a></li>
	</ul>
      </nav>
    </div>

  </header>
  <div class="article-content">
    <p>
最近のclojure-swankには、emacsから直接swank-serverを起動するための「clojure-jack-in」とemacsコマンドがある。
これを使うと、わざわざ別の端末でswank-serverを起動せずとも、直接裏でサーバーが起動してくれるのでとっても便利である。
のはずなのだが、、、WindowsXPだと例によってうまく起動できないので(Linux版だと問題なし)、ちょっと修正しなくちゃいけない。
ここではその過程をメモしておく。
</p>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">結論</h3>
<div class="outline-text-3" id="text-1">


<p>
結論を示すと下記のパッチでうまくいく。
</p>


<pre class="example">$ diff -u $HOME/bin/lein.bat.orig $HOME/bin/lein.bat
--- /cygdrive/c/Users/mikio/bin/lein.bat.orig  2012-04-05 12:59:29.352024000 +0900
+++ /cygdrive/c/Users/mikio/bin/lein.bat       2012-04-06 13:32:27.537281600 +0900
@@ -23,7 +23,7 @@

 if "x%LEIN_HOME%" == "x" (
     if exist "%CD%\.lein" (
-        if /I NOT %CD%==%USERPROFILE% echo Running in bundled mode.
+        if /I NOT "%CD%"=="%USERPROFILE%" echo Running in bundled mode.
         set LEIN_HOME=%CD%\.lein
     ) else (
         set LEIN_HOME=%USERPROFILE%\.lein
</pre>


</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">経過</h3>
<div class="outline-text-3" id="text-2">

<p>まずlein.bat自体がうまく動くのかためす。
dos窓でlein.batを実行すると下記のエラーがでてしまう。   
</p>


<pre class="example">C:\Documents and Settings\mikio&gt;lein
and の使い方が誤っています。
</pre>

<p>
。。。エラーメッセージが不親切すぎて何していいかわかりません。
dosのバッチファイルを読むのは数年ぶりですがとりあえず
</p>
<p>
デバッグ情報を出すために「echo off」を解除する
</p>


<pre class="example">::@echo off

set JAVA_OPTS=-Dswank.encoding=utf-8-unix
</pre>

<p>
すると下記で停止してることがわかった。
</p>


<pre class="example">C:\Documents and Settings\mikio&gt;if "" NEQ "" cd ""
and の使い方が誤っています。
C:\Documents and Settings\mikio&gt;        if /I NOT C:\Documents and Settings\mikio==C:\Documents and Settings\mikio echo Running in bundled mode.
</pre>


<p>
IF文の条件式で与えられた変数が空白を含むために
条件式が文法エラーになっているようだ。
そこで、その条件式の変数部分をダブルクオーテーションで括ってみた。
</p>
<p>
この状態でlein.batを実行してみたところ通常どおり実行できた。
</p>


<pre class="example">C:\Documents and Settings\mikio&gt;lein.bat
Leiningen is a tool for working with Clojure projects.

Several tasks are available:
classpath   Print the classpath of the current project.
clean       Remove compiled class files and jars from project.
compile     Compile Clojure source into .class files.
deploy      Build jar and deploy to remote repository.
deps        Download :dependencies and put them in :library-path.
help        Display a list of tasks or help for a given task.
install     Install current project or download specified project.
interactive Enter an interactive task shell. Aliased to "int".
jack-in     Jack in to a Clojure SLIME session from Emacs.
jar         Package up all the project's files into a jar file.
javac       Compile Java source files.
new         Create a new project skeleton.
noir        Create and manage noir projects.
plugin      Manage user-level plugins.
pom         Write a pom.xml file to disk for Maven interop.
repl        Start a repl session either with the current project or standalone.
retest      Run only the test namespaces which failed last time around.
run         Run the project's -main function.
search      Search remote maven repositories for matching jars.
swank       Launch swank server for Emacs to connect.
test        Run the project's tests.
test!       Run a project's tests after cleaning and fetching dependencies.
trampoline  Run a task without nesting the project's JVM inside Leiningen's.
uberjar     Package up the project files and all dependencies into a jar file.
upgrade     Upgrade Leiningen to the latest stable release.
version     Print version for Leiningen and the current JVM.

Run lein help $TASK for details.
See also: readme, tutorial, copying, sample, deploying and news.

C:\Documents and Settings\mikio&gt;
</pre>


<p>
この修正が完了した時点で「M-x clojure-jack-in」を実行してみたところ
無事SLIMEのREPLバッファが表示されたよ!
</p>
<p>
わざわざ別窓を開いてswank-serverを起動しなくて済むのでかなり快適になったよ!
</p>
</div>
</div>

  </div>
  
  <footer class="well article-footer">
    Posted on <time datetime="2012-04-06T22:53:00Z"> 金曜日 4月, 06 2012 at 22:53:00</time>.
    <nav class="tag-cloud">
      <h1><i class="icon-tags"></i> related tags</h1>
      <ul>
	<li class="label label-inverse small"><a href="../../../tags/clojure.html">clojure</a></li><li class="label label-inverse small"><a href="../../../tags/dos.html">dos</a></li><li class="label label-inverse small"><a href="../../../tags/slime.html">slime</a></li>
      </ul>
    </nav>
  </footer>
  <div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'mikiokunblog'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

      </div>
      <div id="footer">
	<div class="container">
	  <div class="row">
	    <section class="span3">
	      <h1>About</h1>
	      <p>
<img src="http://ja.gravatar.com/userimage/34519202/9f2afee0916f884e17ba9de3a4d09e70.jpg"  alt="http://ja.gravatar.com/userimage/34519202/9f2afee0916f884e17ba9de3a4d09e70.jpg" />
</p>



<pre class="example">(mikio_kun
 {:興味 "ubuntu/emacs/clojure"
  :一言 "Clojurianになりたい"})
</pre>


	    </section>
	    <nav id="links" class="span3">
	      <h1>Links</h1>
	      <ul>
		<ul>
<li><a href="../../../index.html"><i>icon-home icon-white</i> Home</a>

</li>
<li><a href="Lisp error in nil: (wrong-type-argument arrayp nil)"><i>icon-file icon-white</i> Tips</a>

</li>
<li><a href="../../../tags/index.html"><i>icon-tags icon-white</i> Tags</a>

</li>
<li><a href="../../../archives.html"><i>icon-list icon-white</i> Archives</a>

</li>
<li><a href="../../../index.xml">RSS</a>
</li>
</ul>



	      </ul>
	    </nav>
	    <nav id="archives" class="span3">
	      <h1><a href="../../../archives.html">Archives</a></h1>
	      <ul>
		<li><a href="../../../article/2012/12/22_emacsjdeejava.html">Emacs中毒者に送るJDEEによるJava開発環境の構築</a></li> <li><a href="../../../article/2012/12/22_ack.html">今更ながらackいれた。</a></li> <li><a href="../../../article/2012/12/22_nuxus7ubuntu.html">nuxus7にubuntuをインストール</a></li> <li><a href="../../../article/2012/12/22_nexus7root.html">nexus7をroot化した後にやること</a></li> <li><a href="../../../article/2012/12/22_rootneuxs7.html">root化したneuxs7をアップデート</a></li> <li><a href="../../../article/2012/12/22_cygwinssh.html">cygwinでssh接続できない</a></li> <li><a href="../../../article/2012/12/22_git-remote-origin.html">=git remote= でoriginが表示されなくなった。</a></li> <li><a href="../../../article/2012/12/22_xargs.html">空白を含むファイルをxargsで削除する</a></li> <li><a href="../../../article/2012/12/22_org-online.html">org-onlineをタメス。</a></li> <li><a href="../../../article/2012/12/22_stumpwm.html">stumpwmを試す</a></li> 
	      </ul>
	    </nav>
	    <nav class="tags span3">
	      <h1><a href="../../../tags/index.html">Tags</a></h1>
	      <ul>
  <li style="font-size: 103.33%;"><a href="../../../tags/android.html">android</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/apache.html">apache</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/awk.html">awk</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/blog.html">blog</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/centos.html">centos</a></li> <li style="font-size: 208.33%;"><a href="../../../tags/clojure.html">clojure</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/clojurescript.html">clojurescript</a></li> <li style="font-size: 91.67%;"><a href="../../../tags/commonlisp.html">commonlisp</a></li> <li style="font-size: 91.67%;"><a href="../../../tags/compojure.html">compojure</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/css.html">css</a></li> <li style="font-size: 115.00%;"><a href="../../../tags/cygwin.html">cygwin</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/dos.html">dos</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/dropbox.html">dropbox</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/e2wm.html">e2wm</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/eclipse.html">eclipse</a></li> <li style="font-size: 220.00%;"><a href="../../../tags/emacs.html">emacs</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/emacslisp.html">emacslisp</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/firefox.html">firefox</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/gamedev.html">gamedev</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/gimp.html">gimp</a></li> <li style="font-size: 103.33%;"><a href="../../../tags/git.html">git</a></li> <li style="font-size: 91.67%;"><a href="../../../tags/github.html">github</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/gnus.html">gnus</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/greasemonkey.html">greasemonkey</a></li> <li style="font-size: 185.00%;"><a href="../../../tags/hamari.html">hamari</a></li> <li style="font-size: 91.67%;"><a href="../../../tags/hiccup.html">hiccup</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/howm.html">howm</a></li> <li style="font-size: 91.67%;"><a href="../../../tags/java.html">java</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/javascript.html">javascript</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/jdee.html">jdee</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/less.html">less</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/linux.html">linux</a></li> <li style="font-size: 115.00%;"><a href="../../../tags/lisp.html">lisp</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/lvm.html">lvm</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/mew.html">mew</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/misaki.html">misaki</a></li> <li style="font-size: 103.33%;"><a href="../../../tags/nexus7.html">nexus7</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/notes.html">notes</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/nrepl.html">nrepl</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/o.html">o</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/playframework.html">playframework</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/problem.html">problem</a></li> <li style="font-size: 91.67%;"><a href="../../../tags/ring.html">ring</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/rooted.html">rooted</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/sbcl.html">sbcl</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/scheme.html">scheme</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/sdic.html">sdic</a></li> <li style="font-size: 91.67%;"><a href="../../../tags/skk.html">skk</a></li> <li style="font-size: 138.33%;"><a href="../../../tags/slime.html">slime</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/ssh.html">ssh</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/sudo.html">sudo</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/svn.html">svn</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/swank.html">swank</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/test.html">test</a></li> <li style="font-size: 91.67%;"><a href="../../../tags/ubuntu.html">ubuntu</a></li> <li style="font-size: 91.67%;"><a href="../../../tags/windows.html">windows</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/windowsxp.html">windowsxp</a></li> <li style="font-size: 80.00%;"><a href="../../../tags/xmonad.html">xmonad</a></li> 
</ul>

	    </nav>
	  </div>
	</div>
	<div class="copyright" style="text-align: center;">
	  <p>
Copyright © 2008-2012 <a href="http://twitter.com/mikio_kun">mikio</a>
</p>
	  <p>Powered by <a href="https://github.com/renard/o-blog">o-blog</a>.</p>
	</div>
      </div>
</body>
</html>

