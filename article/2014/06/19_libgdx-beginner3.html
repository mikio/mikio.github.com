<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A layout example that shows off a responsive pricing table.">
    <title>libGDX入門 その3 ログ出力とアニメーションとバーチャルパッド|ざる魂</title>

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/main-grid-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/main-grid.css">
    <!--<![endif]-->

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/layouts/pricing-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/layouts/pricing.css">
    <!--<![endif]-->

        <link href="/atom.xml" rel="alternate" title="ざる魂" type="application/atom+xml" />
    

        <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.4.2/pure.css" />
    

        <link rel="stylesheet" href="/css/main.css" />
    

  </head>
  <body>
    <header class="global-header">
      <div class="container">
        <div class="site-header">
          <a href="/"><img src="/img/zarudama-logo.png"></img></a>
          <p>真似て学んで「まねぶ」サル。知られざる我が魂。</p>
        </div>
      </div>
    </header>

    <div class="l-content">
      <div class="information ">

        <div class="pure-menu pure-menu-open pure-menu-horizontal">
          <ul>
            <li><a href="/archives.html">Archives</a></li>
            <li><a href="/tags.html">Tags</a></li>
            <li><a href="/about.html">About</a></li>
          </ul>
        </div>

        <div class="article-header">
  <div class="title">
    <h1><a href="">libGDX入門 その3 ログ出力とアニメーションとバーチャルパッド</a></h1>
  </div>
  <p class="date">2014/6/19</p>
</div>

<div class="content">
  <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. はじめに</a></li>
<li><a href="#sec-2">2. ログの出しかた</a></li>
<li><a href="#sec-3">3. スプライトアニメーション</a></li>
<li><a href="#sec-4">4. バーチャルパッド</a></li>
<li><a href="#sec-5">5. テクスチャラップ</a></li>
<li><a href="#sec-6">6. ソースコード</a></li>
<li><a href="#sec-7">7. 今回の記事のアセット一覧</a>
<ul>
<li><a href="#sec-7-1">7.1. テクスチャ</a></li>
<li><a href="#sec-7-2">7.2. 背景</a></li>
<li><a href="#sec-7-3">7.3. BGM</a></li>
</ul>
</li>
<li><a href="#sec-8">8. おわりに</a></li>
<li><a href="#sec-9">9. 変更履歴</a></li>
<li><a href="#sec-10">10. 参考書籍</a></li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> はじめに</h2>
<div class="outline-text-2" id="text-1">
<p>
<a href="http://libgdx.badlogicgames.com/">libGDX</a> を勉強するついでに解説記事を書くシリーズ3回目です。
</p>

<p>
<a href="http://mikio.github.io/article/2014/06/02_libgdx-beginner2.html">前回</a> は、以下のことを学びました。
</p>
<ul class="org-ul">
<li>カメラとビューポート
</li>
<li>タッチ処理
</li>
</ul>
<p>
今回は次のことを学びます。
</p>

<ul class="org-ul">
<li>ログ出力
</li>
<li>スプライト表示のアニメーション
</li>
<li>テクスチャラップ
</li>
<li>バーチャルパッド
</li>
</ul>

<p>
前回までは、最初の雛形コードに徐々にコードを継ぎたして完成させるというチュートリアル形式でしたが、
実際にコードを入力しながら実行していくのは少ないんじゃないかという疑問と(自分も含めて)、
記事を書くのが大変なので(手抜き)、最初に一気に解説し、最後にコードを載せるスタイルにします。
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> ログの出しかた</h2>
<div class="outline-text-2" id="text-2">
<p>
プログラムの動作を追うとき、ログ出力はとても重宝しますよね。
デバッガもいいですが、私は昔ながらのデバッグプリントで追うのが好きです。
</p>

<p>
ということで、ログ出力の方法を解説します。
</p>

<p>
公式から引用します。
</p>
<div class="org-src-container">

<pre class="src src-java">Gdx.app.log(<span class="org-string">"MyTag"</span>, <span class="org-string">"my informative message"</span>);
Gdx.app.error(<span class="org-string">"MyTag"</span>, <span class="org-string">"my error message"</span>, exception);
Gdx.app.debug(<span class="org-string">"MyTag"</span>, <span class="org-string">"my error message"</span>);
</pre>
</div>

<p>
<code>log</code> メソッドは普通に情報を出力したい場合、
<code>error</code> メソッドは、例外を共なうようなエラー出力(第3引数にはException型)をしたい場合、
<code>debug</code> メソッドは開発時のみ出力したい場合に使用します。
</p>

<p>
第一引数の <code>MyTag</code> は識別子ですね。一般的にはにはクラス名などが多いようです。
自分は下記のようにクラスフィールドを定義しておき、この <code>LOG_TAG</code> を使用します。
</p>
<div class="org-src-container">

<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">final</span> <span class="org-type">String</span> <span class="org-variable-name">LOG_TAG</span> = GameScreen.<span class="org-keyword">class</span>.getSimpleName();
</pre>
</div>

<p>
こんな感じです。
</p>
<div class="org-src-container">

<pre class="src src-java">Gdx.app.log(LOG_TAG, <span class="org-string">"my informative message"</span>);
</pre>
</div>
<p>
次のように表示されます。
</p>
<div class="org-src-container">

<pre class="src src-sh">GameScreen: my informative message
</pre>
</div>
<p>
こうするとログ出力にクラス名も一緒に表示されるので、
どこで出力したメッセージか一目でわかるので便利です。
</p>

<p>
これらのログ出力は、ログのレベルを指定することで
メッセージの出力範囲を制御できます。
</p>

<p>
下記のように指定します。
</p>
<div class="org-src-container">

<pre class="src src-sh"><span class="org-function-name">Gdx.app.setLogLevel</span>(Application.LOG_DEBUG);
</pre>
</div>
<p>
上はデバッグレベルを指定しています。
</p>

<p>
ログレベルには下記の4種類あります。
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">Application.LOG_NONE</td>
<td class="left">全てのログを無効にします。</td>
</tr>

<tr>
<td class="left">Application.LOG_DEBUG</td>
<td class="left">全てのログを出力します。</td>
</tr>

<tr>
<td class="left">Application.LOG_ERROR</td>
<td class="left">errorメソッドのログだけ出力します。</td>
</tr>

<tr>
<td class="left">Application.LOG_INFO</td>
<td class="left">logとerrorメソッドのログを出力します。</td>
</tr>
</tbody>
</table>

<p>
開発時は、DEBUGレベル、リリース時は、NONEレベルですかね。
パフォーマンス重視の場合は、ログメソッドはリリース時に全て削除したほうがいいです。
</p>

<p>
公式情報は下記にあります。
</p>
<ul class="org-ul">
<li><a href="https://github.com/libgdx/libgdx/wiki/Logging">https://github.com/libgdx/libgdx/wiki/Logging</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> スプライトアニメーション</h2>
<div class="outline-text-2" id="text-3">
<p>
前回までは静止画を拡縮機能で伸び縮みさせただけでした。
今回は、パターンをつくってアニメーションさせて見ます。
アニメーションさせるとグっとゲーム感が増します。
</p>

<p>
完成したプログラムのスクリーンショットです。
</p>


<div class="figure">
<p><img src="http://mikio.github.io/img/libgdx-beginner/3/000.png" alt="000.png" />
</p>
<p><span class="figure-number">Figure 1:</span> 完成したプログラム</p>
</div>

<p>
仕様としては、
</p>
<ul class="org-ul">
<li>ターゲット解像度はファミコンライク(16:9の256 x 144ドット)
</li>
<li>16x16ドットの猫のキャラを表示
</li>
<li>待機モーションあり
</li>
<li>走りモーションあり
</li>
<li>左右に移動
</li>
<li>バーチャルパッド
</li>
</ul>
<p>
って感じにしました。
</p>

<p>
そして作ったのがこれ。
</p>


<div class="figure">
<p><img src="http://mikio.github.io/img/libgdx-beginner/3/neko.png" alt="neko.png" />
</p>
<p><span class="figure-number">Figure 2:</span> ねこの画像</p>
</div>

<p>
左から
</p>
<ul class="org-ul">
<li>待機1, 待機2, 走り1, 走り2, 走り3
</li>
</ul>
<p>
と計5コマのスプライトアニメとなっております。
猫の画像の下には、左右に動かすためのボタンがあります。
</p>

<p>
画像のサイズは、256x256にしてあります。使用している画像サイズを考えると大きすぎますが、
一般的には、画像のサイズは512x512,1024x1024あたりがVRAMへの転送効率が良いと言われており、
今回は、単に512だと大きすぎて作業しずらかったので512の半分の256にしました。
画像サイズは2のn乗でないと効率的に扱えないことが多いので、512あたりのサイズが無難です。
</p>

<p>
また、画像の単位を16x16ドットのセル単位で描くようにしています。
こうすることによりコード内での単位が統一されプログラミングしやすくなります。
</p>

<p>
スプライトアニメさせるためには、専用のクラスを準備します。
今回は、走りモーションと待機モーションが2種類あり、左右分用意するため、
合計4種類のアニメーションが必要になります。
</p>

<p>
下記のフィールドを準備します。
</p>
<div class="org-src-container">

<pre class="src src-java"><span class="org-keyword">private</span> <span class="org-type">Animation</span> <span class="org-variable-name">animLeft</span>;
<span class="org-keyword">private</span> <span class="org-type">Animation</span> <span class="org-variable-name">animRight</span>;
<span class="org-keyword">private</span> <span class="org-type">Animation</span> <span class="org-variable-name">animIdleLeft</span>;
<span class="org-keyword">private</span> <span class="org-type">Animation</span> <span class="org-variable-name">animIdleRight</span>;
<span class="org-keyword">private</span> <span class="org-type">float</span> <span class="org-variable-name">stateTime</span> = 0;
</pre>
</div>

<p>
アニメーションの具体的なコードは下記になります。
</p>

<div class="org-src-container">

<pre class="src src-java"><span class="org-type">TextureRegion</span>[] <span class="org-variable-name">split</span> = <span class="org-keyword">new</span> <span class="org-type">TextureRegion</span>(img).split(16, 16)[0];  <span class="org-comment-delimiter">// </span><span class="org-comment">#1</span>
<span class="org-type">TextureRegion</span>[] <span class="org-variable-name">mirror</span> = <span class="org-keyword">new</span> <span class="org-type">TextureRegion</span>(img).split(16, 16)[0]; <span class="org-comment-delimiter">// </span><span class="org-comment">#2</span>
<span class="org-keyword">for</span> (<span class="org-type">TextureRegion</span> <span class="org-variable-name">region</span> : mirror) <span class="org-comment-delimiter">// </span><span class="org-comment">#3</span>
    region.flip(<span class="org-constant">true</span>, <span class="org-constant">false</span>);
animRight = <span class="org-keyword">new</span> <span class="org-type">Animation</span>(0.1f, split[2], split[3], split[4]); <span class="org-comment-delimiter">// </span><span class="org-comment">#4</span>
animLeft = <span class="org-keyword">new</span> <span class="org-type">Animation</span>(0.1f,  mirror[2], mirror[3], mirror[4]);
animIdleRight = <span class="org-keyword">new</span> <span class="org-type">Animation</span>(0.5f, split[0], split[1]);
animIdleLeft = <span class="org-keyword">new</span> <span class="org-type">Animation</span>(0.5f, mirror[0], mirror[1]);
stateTime = 0; <span class="org-comment-delimiter">// </span><span class="org-comment">#5</span>
</pre>
</div>
<p>
<code>TextureRegion</code> クラスは、ある一枚のテクスチャの一部の矩形情報をもったオブジェクトです。
<code>TextureRegion</code> にアニメーションの1コマ1コマを格納し、その <code>TextureRegion</code> を描画することで
アニメーションさせます。
</p>

<p>
 <code>#1</code> では、 <code>TextureRegion#split()</code> メソッドで <code>img</code> テクスチャを16x16(単位はピクセル)のセルで分割し、
TextureRegion の2次元配列を取得します。同時にその2次元配列の1行目を取得することで、
テクスチャの最初の行の画像(猫のアニメーションパターン)を取得しています。
(今回は、1行目だけが必要なので、0固定です)。
</p>

<p>
 <code>#2</code> では、 <code>#1</code> と同様ですが、左向きのデータを得るために、 <code>#3</code> でデータを左右反転しています。
 <code>TexutreRegion#flip()</code> メソッドの第一引数は、x軸、第二引数は、Y軸の反転指定になります。
この場合はX軸のみ指定しています。これで左向きのアニメーションパターンを手に入れることができました。
</p>

<p>
<code>Animeation</code> クラスは、アニメーション情報を保持するオブジェクトです。コンストラクタの第一引数に各コマの秒数、
第二引数以降には、そのアニメーションを構成する <code>TextureRegin</code> オブジェクトを可変引数として渡します。
<code>#4</code> の場合は、3コマを0.1秒ごとに切り替えるアニメで、先に生成したsplitからそれぞれのコマを指定します。
</p>

<p>
<code>stateTime</code> は、アニメーションの進行に必要な経過時間を保持します。
</p>

<p>
以上で準備できました。
あとは、猫の状態に応じて(右を向いてるのか左を向いてるのか、止っているのか、走っているのかなど)、
適切な <code>Animation</code> オブジェクトを選択して下記のように描画します。
</p>
<div class="org-src-container">

<pre class="src src-java">batch.begin();
bg.draw(batch);

<span class="org-type">boolean</span> <span class="org-variable-name">loop</span> = <span class="org-constant">true</span>;
<span class="org-type">float</span> <span class="org-variable-name">width</span> = 16;
<span class="org-type">float</span> <span class="org-variable-name">height</span> = 16;
<span class="org-type">Animation</span> <span class="org-variable-name">nekoAnim</span> = currentAnim(); <span class="org-comment-delimiter">// </span><span class="org-comment">#1</span>
batch.draw(nekoAnim.getKeyFrame(stateTime, loop), <span class="org-comment-delimiter">// </span><span class="org-comment">#2</span>
           pos.x, pos.y,   <span class="org-comment-delimiter">// </span><span class="org-comment">#3</span>
           width, height); <span class="org-comment-delimiter">// </span><span class="org-comment">#4</span>

batch.end();
stateTime += Gdx.graphics.getDeltaTime(); <span class="org-comment-delimiter">// </span><span class="org-comment">#5</span>
</pre>
</div>
<p>
 <code>#1</code> では、 <code>currentAnim()</code> メソッド(自前メソッド、後述)から、現在のアニメーションを取得します。
 <code>#2</code> では、 <code>Animation#getKeyFrame()</code> メソッドの第一引数へ現在の経過時間を渡し、
適切な <code>TexutreRegion</code> オブジェクトを取得します。
第二引数では、アニメーションをループするかどうかを指定します。
 <code>#3</code> 、 <code>#4</code> で描画先の座標と、描画の幅と高さを指定します。
 <code>#5</code> では、 <code>Gdx.graphics.getDeltaTime()</code> メソッドを使って、
前回のフレームからの経過時間を取得しています(単位は秒)。
<code>stateTime</code> の値を増加させることでアニメーションのコマを進めることができます。
</p>


<p>
さて、このプログラムでは次のように直行する2つの状態を扱って、アニメーションを切り替えています。
</p>


<div class="figure">
<p><img src="http://mikio.github.io/img/libgdx-beginner/3/state.png" alt="state.png" />
</p>
<p><span class="figure-number">Figure 3:</span> アニメーションの状態</p>
</div>

<p>
この状態をプログラムしたのが上述の <code>currentAnim()</code> メソッドです。
</p>
<div class="org-src-container">

<pre class="src src-java"><span class="org-keyword">private</span> <span class="org-type">Animation</span> <span class="org-function-name">currentAnim</span>() {
    <span class="org-type">Animation</span> <span class="org-variable-name">anim</span> = <span class="org-constant">null</span>;
    <span class="org-keyword">if</span> (state == STATE_MOVE) {
        <span class="org-keyword">if</span> (dir == DIR_LEFT) {
            anim = animLeft;
        } <span class="org-keyword">else</span> {
            anim = animRight;
        }
    } <span class="org-keyword">else</span> {
        <span class="org-keyword">if</span> (dir == DIR_LEFT) {
            anim = animIdleLeft;
        } <span class="org-keyword">else</span> {
            anim = animIdleRight;
        }
    }
    <span class="org-keyword">return</span> anim;
}
</pre>
</div>
<p>
 <code>state</code> は移動状態、 <code>dir</code> は向きの状態です。中身は、クラスフィールドで定義しておきます。
libGDXには直接関係ありませんが、わかりづらいところかもしれないので解説しました。
</p>


<p>
ここまでの情報でアニメーションをどう表示させるかがわかったと思います。
しかし、どう動かすかはまだ決めていません。
</p>

<p>
前回までにタッチ処理の方法はわかったので、今回はスプライトでボタンもどきを作って
そのボタンをタッチしている間、左右に動かすようにしてみます。
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> バーチャルパッド</h2>
<div class="outline-text-2" id="text-4">
<p>
仕組みは簡単です。左と右を表わすボタンスプライトを用意し、
タッチ座標がそのスプライトの矩形に入っているかどうかを判定します。
矩形に入っていれば、そのボタンの明度を下げて押されているように見せかけます。
</p>

<p>
まずスプライトの準備です。次のフィールドを用意します。
</p>
<div class="org-src-container">

<pre class="src src-java"><span class="org-keyword">private</span> <span class="org-type">Sprite</span> <span class="org-variable-name">leftButton</span>;
<span class="org-keyword">private</span> <span class="org-type">Sprite</span> <span class="org-variable-name">rightButton</span>;
</pre>
</div>

<p>
初期化は以下のような感じ。
</p>
<div class="org-src-container">

<pre class="src src-java">leftButton = <span class="org-keyword">new</span> <span class="org-type">Sprite</span>(img, 0, 16*2, 16*3, 16*2);
rightButton = <span class="org-keyword">new</span> <span class="org-type">Sprite</span>(img, 16*3, 16*2, 16*3, 16*2);
leftButton.setPosition(8, 0);
rightButton.setPosition(8 + 16*3, 0);
</pre>
</div>
<p>
左下に表示させるべく、16ドットを1マスとして計算しています。
</p>

<p>
そしてボタンがタッチされたかどうかの判定です。
これはこのプログラムの一番重要なところかもしれません。
</p>
<div class="org-src-container">

<pre class="src src-java">leftButton.setColor(<span class="org-constant">Color</span>.WHITE);  <span class="org-comment-delimiter">// </span><span class="org-comment">#1</span>
rightButton.setColor(<span class="org-constant">Color</span>.WHITE); <span class="org-comment-delimiter">// </span><span class="org-comment">#2</span>
<span class="org-keyword">if</span> (Gdx.input.isTouched()) { <span class="org-comment-delimiter">// </span><span class="org-comment">#3</span>
    <span class="org-type">float</span> <span class="org-variable-name">x</span> = Gdx.input.getX(); <span class="org-comment-delimiter">// </span><span class="org-comment">#4</span>
    <span class="org-type">float</span> <span class="org-variable-name">y</span> = Gdx.input.getY();
    uiViewport.unproject(touchPoint.set(x, y, 0)); <span class="org-comment-delimiter">// </span><span class="org-comment">#5</span>
    <span class="org-type">Rectangle</span> <span class="org-variable-name">leftBounds</span> = leftButton.getBoundingRectangle(); <span class="org-comment-delimiter">// </span><span class="org-comment">#6</span>
    <span class="org-type">Rectangle</span> <span class="org-variable-name">rightBounds</span> = rightButton.getBoundingRectangle(); <span class="org-comment-delimiter">// </span><span class="org-comment">#7</span>
    <span class="org-keyword">if</span> (leftBounds.contains(touchPoint.x, touchPoint.y)) { <span class="org-comment-delimiter">// </span><span class="org-comment">#8</span>
        leftButton.setColor(<span class="org-constant">Color</span>.GRAY); <span class="org-comment-delimiter">// </span><span class="org-comment">#9</span>
        left();
    } <span class="org-keyword">else</span> <span class="org-keyword">if</span> (rightBounds.contains(touchPoint.x, touchPoint.y)) { <span class="org-comment-delimiter">// </span><span class="org-comment">#10</span>
        rightButton.setColor(<span class="org-constant">Color</span>.GRAY); <span class="org-comment-delimiter">// </span><span class="org-comment">#11</span>
        right();
    }
}
</pre>
</div>
<p>
 <code>#1</code> 、 <code>#2</code> では、ボタンスプライトの明度を初期化しています。カラーをホワイトにすることにより、
通常のスプライトのテクスチャのカラーをそのまま表示することになります。
</p>

<p>
 <code>#3</code> は、前回解説しました。タッチさたかどうかを判定するメソッドです。
画面をタッチしつづける限り真が返ってきます。
</p>

<p>
 <code>#4</code> は、タッチされた座標を取得します。この座標は左上を原点とするスクリーン座標が返ってくるので
そのままでは使えません。
</p>

<p>
 <code>#5</code> の <code>uiViewPort.unproject()</code> メソッドで、
 <code>#6</code> で取得したタッチ座標をビューポート座標経由でワールド座標に変換します。
前回の記事でここの解説に誤りがありました( m(_ _)m )。前回の記事では、 <code>Viewport#unproject</code> ではなく、
 <code>Camera#unproject</code> メソッドを使用していました。これだとビューポートを考慮しないので、正しい座標が返ってきません。
 <code>Viewport</code> クラスを使用している場合は、 <code>Viewport#unproject</code> メソッドを使用してください。
</p>

<p>
<code>#6</code> 、 <code>#7</code> では、ボタンスプライトの矩形情報を <code>Rectangle</code> クラスに格納します。
<code>Rectangle</code> クラスは、矩形の左下の位置と、幅と高さの情報を持つクラスです。
</p>

<p>
<code>#8</code> 、 <code>#10</code> では、 <code>Rectangle#contains()</code> メソッドにより、タッチ座標が矩形内にあるかどうかを判定します。
真であれば、ボタンをタッチしたことになるので、移動処理(right,leftメソッド)を実行します。
</p>

<p>
<code>#9</code> 、 <code>#11</code> では、 ボタンが押されていることを視覚的にわからせるために、スプライトの明度を下げています。
<code>Color.GRAY</code> を指定することで、半分位の暗さになり、丁度いい感じになります。
</p>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> テクスチャラップ</h2>
<div class="outline-text-2" id="text-5">
<p>
今回、背景には、空の画像を使用していますが、
これには「テクスチャラップ」というOpenGLの機能を使用しています。
</p>

<p>
通常テクスチャの座標を指定するには、テクスチャ座標系を使用します。
</p>

<p>
テクスチャ座標系とは、左上を原点とし、U軸は右方向、
V軸は下方向に伸びる軸を持つ座標系のことです。<sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>
</p>


<div class="figure">
<p><img src="http://mikio.github.io/img/libgdx-beginner/3/texture-wrap.png" alt="texture-wrap.png" />
</p>
<p><span class="figure-number">Figure 4:</span> テクスチャ座標</p>
</div>

<p>
テクスチャ座標系では、ピクセル座標ではなく、1.0を最大値とした正規化した座標を指定します。
正規化した座標とは、画像のサイズを1.0に丸めたものです。
</p>
<pre class="example">
正規化座標 = ピクセル座標 ÷ テクスチャサイズ
</pre>
<p>
で求まります。
</p>

<p>
例えば、512x512のテクスチャサイズの(256,256)のUV座標を得る場合は、
 <code>256/512=0.5</code> となり、正規化座標は、0.5となります。
</p>

<p>
通常は、この1.0内のなかで座標を指定すれば良いのですが、
1.0より大きい値を指定することもできます。
ただしその場合は、1.0を超えたときの挙動を予め指定しておく必要があります。
</p>

<p>
今回は、背景の画像に対して、1.0以上の値を指定し、
その挙動として、テクスチャの画像を繰り返す指定をしました。
</p>

<p>
テクスチャラップのコードは以下になります。
</p>
<div class="org-src-container">

<pre class="src src-java">bgImg.setWrap(<span class="org-constant">TextureWrap</span>.Repeat, <span class="org-constant">TextureWrap</span>.Repeat); <span class="org-comment-delimiter">// </span><span class="org-comment">#1</span>
bg = <span class="org-keyword">new</span> <span class="org-type">Sprite</span>(bgImg, 0, 0, LOGICAL_WIDTH, LOGICAL_HEIGHT); <span class="org-comment-delimiter">// </span><span class="org-comment">#2</span>
bg.setU(0); <span class="org-comment-delimiter">// </span><span class="org-comment">#3</span>
bg.setU2(5);
bg.setV(0);
bg.setV2(5);
</pre>
</div>

<p>
<code>#1</code> で、1.0を超えたUV指定をしたとき、テクスチャを繰り返す指定をしています。
<code>#2</code> で、背景のスプライトサイズを指定しています。これはターゲット解像度と同じ大きさにしています。
<code>#3</code> で、UV座標として、0.0 〜 5.0 の値を指定しています。
<code>setU(), setV()</code> が左上の座標、 <code>setU2(), setV2()</code> が右下の座標になります。
</p>

<p>
あとは、実際の描画ですが、今回の背景の場合、画面に固定で表示したかったため
UIカメラを使って描画しています。
</p>

<div class="org-src-container">

<pre class="src src-java"><span class="org-keyword">private</span> <span class="org-type">void</span> <span class="org-function-name">draw</span>() {
    <span class="org-comment-delimiter">// </span><span class="org-comment">BG&#12459;&#12513;&#12521;&#12475;&#12483;&#12488;&#12450;&#12483;&#12503;</span>
    uiCamera.update();
    batch.setProjectionMatrix(uiCamera.combined);
    batch.begin();
    bg.draw(batch);
    batch.end();

    :
}
</pre>
</div>
<p>
背景として描画するため、drawメソッドの開始直後に描画しています。
</p>

<p>
今回は詳しく解説しませんが、UV座標を毎フレームずらすことでスクロール処理することができます。
</p>

<p>
これを一般的にUVスクロールといいます。
</p>

<p>
 一昔まえのゲームのタイトルやプレーヤーセレクト画面などで多様されていました。
<code>update</code> メソッドの最後にコメントアウトしておきましたので、
興味のある人は、コメントを外してみてください。おもしろい効果だと思いますのでおすすめです。
</p>


<p>
以上で、今回の肝となる部分の解説を終えました。
ぜひ、次章のソースコードをコピペし、アセット一覧をダウンロードしてプログラムを実行してみてください。
生意気げなクロネコがリズムを取りながら待機し、ボタンを押すことで走りまわります。
</p>

<p>
隠れデバッグ機能として、Rキーでネコの位置をリセットします。
</p>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> ソースコード</h2>
<div class="outline-text-2" id="text-6">
<p>
今回解説したプログラムの全ソースです。
</p>

<div class="org-src-container">

<pre class="src src-java"><span class="org-keyword">package</span> com.zarudama.<span class="org-constant">libgdxtest</span>;

<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-type">Application</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-type">ApplicationAdapter</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-type">Gdx</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-type">Input</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">audio</span>.<span class="org-type">Music</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-type">Color</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-type">GL20</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-type">OrthographicCamera</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-type">Camera</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-type">Texture</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-constant">Texture</span>.<span class="org-type">TextureWrap</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-constant">g2d</span>.<span class="org-type">Animation</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-constant">g2d</span>.<span class="org-type">BitmapFont</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-constant">g2d</span>.<span class="org-type">Sprite</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-constant">g2d</span>.<span class="org-type">SpriteBatch</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-constant">g2d</span>.<span class="org-type">TextureRegion</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">math</span>.<span class="org-type">Rectangle</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">math</span>.<span class="org-type">Vector2</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">math</span>.<span class="org-type">Vector3</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">utils</span>.<span class="org-constant">viewport</span>.<span class="org-type">FitViewport</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">utils</span>.<span class="org-constant">viewport</span>.<span class="org-type">Viewport</span>;
<span class="org-keyword">import</span> <span class="org-constant">com</span>.<span class="org-constant">badlogic</span>.<span class="org-constant">gdx</span>.<span class="org-constant">graphics</span>.<span class="org-constant">glutils</span>.<span class="org-type">ShapeRenderer</span>;

<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">LibGdxSample</span> <span class="org-keyword">extends</span> <span class="org-type">ApplicationAdapter</span> {
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">final</span> <span class="org-type">String</span> <span class="org-variable-name">LOG_TAG</span> = LibGdxSample.<span class="org-keyword">class</span>.getSimpleName();

    <span class="org-comment-delimiter">// </span><span class="org-comment">16:9</span>
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">int</span> <span class="org-variable-name">LOGICAL_WIDTH</span> = 256;
    <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-type">int</span> <span class="org-variable-name">LOGICAL_HEIGHT</span> = 144;

    <span class="org-comment-delimiter">// </span><span class="org-comment">1&#31186;&#38291;&#12395;16x3&#12489;&#12483;&#12488;&#36914;&#12416;</span>
    <span class="org-keyword">private</span> <span class="org-keyword">static</span> <span class="org-keyword">final</span> <span class="org-type">float</span> <span class="org-variable-name">MOVE_SPEED</span> = 16*3.0f/60;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#31227;&#21205;&#29366;&#24907;</span>
    <span class="org-keyword">private</span> <span class="org-keyword">static</span> <span class="org-keyword">final</span> <span class="org-type">int</span> <span class="org-variable-name">STATE_IDLE</span> = 0;
    <span class="org-keyword">private</span> <span class="org-keyword">static</span> <span class="org-keyword">final</span> <span class="org-type">int</span> <span class="org-variable-name">STATE_MOVE</span> = 1;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#21521;&#12365;&#29366;&#24907;</span>
    <span class="org-keyword">private</span> <span class="org-keyword">static</span> <span class="org-keyword">final</span> <span class="org-type">int</span> <span class="org-variable-name">DIR_RIGHT</span> = 1;
    <span class="org-keyword">private</span> <span class="org-keyword">static</span> <span class="org-keyword">final</span> <span class="org-type">int</span> <span class="org-variable-name">DIR_LEFT</span> = 2;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#12466;&#12540;&#12512;&#12395;&#20351;&#29992;&#12377;&#12427;&#12486;&#12463;&#12473;&#12481;&#12515;</span>
    <span class="org-keyword">private</span> <span class="org-type">Texture</span> <span class="org-variable-name">img</span>;

    <span class="org-keyword">private</span> <span class="org-type">SpriteBatch</span> <span class="org-variable-name">batch</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">BGM</span>
    <span class="org-keyword">private</span> <span class="org-type">Music</span> <span class="org-variable-name">music</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#30011;&#38754;&#12501;&#12457;&#12531;&#12488;&#29992;</span>
    <span class="org-keyword">private</span> <span class="org-type">BitmapFont</span> <span class="org-variable-name">font</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#12466;&#12540;&#12512;&#12459;&#12513;&#12521;&#12392;&#12499;&#12517;&#12509;&#12540;&#12488;</span>
    <span class="org-keyword">private</span> <span class="org-type">OrthographicCamera</span> <span class="org-variable-name">camera</span>;
    <span class="org-keyword">private</span> <span class="org-type">Viewport</span> <span class="org-variable-name">viewport</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">UI&#12459;&#12513;&#12521;&#12392;&#12499;&#12517;&#12509;&#12540;&#12488;</span>
    <span class="org-keyword">private</span> <span class="org-type">OrthographicCamera</span> <span class="org-variable-name">uiCamera</span>;
    <span class="org-keyword">private</span> <span class="org-type">Viewport</span> <span class="org-variable-name">uiViewport</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#12479;&#12483;&#12481;&#24231;&#27161;&#22793;&#25563;&#29992;&#12454;&#12465;&#12470;&#12521;</span>
    <span class="org-keyword">private</span> <span class="org-type">Vector3</span> <span class="org-variable-name">touchPoint</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#24038;&#21491;&#12398;&#12508;&#12479;&#12531;</span>
    <span class="org-keyword">private</span> <span class="org-type">Sprite</span> <span class="org-variable-name">leftButton</span>;
    <span class="org-keyword">private</span> <span class="org-type">Sprite</span> <span class="org-variable-name">rightButton</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#32972;&#26223;&#29992;</span>
    <span class="org-keyword">private</span> <span class="org-type">Texture</span> <span class="org-variable-name">bgImg</span>;
    <span class="org-keyword">private</span> <span class="org-type">Sprite</span> <span class="org-variable-name">bg</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#12487;&#12496;&#12483;&#12464;&#29992;&#12527;&#12540;&#12523;&#12489;&#24231;&#27161;&#36600;</span>
    <span class="org-keyword">private</span> <span class="org-type">ShapeRenderer</span> <span class="org-variable-name">shapeRenderer</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#12397;&#12371;&#12450;&#12491;&#12513;&#12540;&#12471;&#12519;&#12531;</span>
    <span class="org-keyword">private</span> <span class="org-type">Animation</span> <span class="org-variable-name">animLeft</span>;
    <span class="org-keyword">private</span> <span class="org-type">Animation</span> <span class="org-variable-name">animRight</span>;
    <span class="org-keyword">private</span> <span class="org-type">Animation</span> <span class="org-variable-name">animIdleLeft</span>;
    <span class="org-keyword">private</span> <span class="org-type">Animation</span> <span class="org-variable-name">animIdleRight</span>;
    <span class="org-keyword">private</span> <span class="org-type">float</span> <span class="org-variable-name">stateTime</span> = 0;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#29483;&#24231;&#27161;</span>
    <span class="org-keyword">private</span> <span class="org-type">Vector2</span> <span class="org-variable-name">pos</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">&#29366;&#24907;</span>
    <span class="org-keyword">private</span> <span class="org-type">int</span> <span class="org-variable-name">state</span>;
    <span class="org-keyword">private</span> <span class="org-type">int</span> <span class="org-variable-name">dir</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">UV&#12473;&#12463;&#12525;&#12540;&#12523;&#29992;</span>
    <span class="org-keyword">private</span> <span class="org-type">float</span> <span class="org-variable-name">scrollCounter</span>;


    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">create</span>() {
        touchPoint = <span class="org-keyword">new</span> <span class="org-type">Vector3</span>();
        batch = <span class="org-keyword">new</span> <span class="org-type">SpriteBatch</span>();
        font = <span class="org-keyword">new</span> <span class="org-type">BitmapFont</span>();
        img = <span class="org-keyword">new</span> <span class="org-type">Texture</span>(Gdx.files.internal(<span class="org-string">"neko.png"</span>));
        pos = <span class="org-keyword">new</span> <span class="org-type">Vector2</span>();
        music = Gdx.audio.newMusic(Gdx.files.internal(<span class="org-string">"mixdown.mp3"</span>));
        music.setLooping(<span class="org-constant">true</span>);
        music.setVolume(0.3f);
        music.play();

        bgImg = <span class="org-keyword">new</span> <span class="org-type">Texture</span>(<span class="org-string">"bg.png"</span>);
        bgImg.setWrap(<span class="org-constant">TextureWrap</span>.Repeat, <span class="org-constant">TextureWrap</span>.Repeat);
        bg = <span class="org-keyword">new</span> <span class="org-type">Sprite</span>(bgImg, 0, 0, LOGICAL_WIDTH, LOGICAL_HEIGHT);
        bg.setU(0);
        bg.setU2(5);
        bg.setV(0);
        bg.setV2(5);
        scrollCounter = 0.0f;

        camera = <span class="org-keyword">new</span> <span class="org-type">OrthographicCamera</span>();
        camera.position.x = 0;
        camera.position.y = LOGICAL_HEIGHT/2 - 16*2;
        viewport = <span class="org-keyword">new</span> <span class="org-type">FitViewport</span>(LOGICAL_WIDTH, LOGICAL_HEIGHT, camera);

        uiCamera = <span class="org-keyword">new</span> <span class="org-type">OrthographicCamera</span>();
        uiCamera.setToOrtho(<span class="org-constant">false</span>, LOGICAL_WIDTH, LOGICAL_HEIGHT);
        uiViewport = <span class="org-keyword">new</span> <span class="org-type">FitViewport</span>(LOGICAL_WIDTH, LOGICAL_HEIGHT, uiCamera);

        shapeRenderer = <span class="org-keyword">new</span> <span class="org-type">ShapeRenderer</span>();

        <span class="org-comment-delimiter">// </span><span class="org-comment">&#12450;&#12491;&#12513;&#12540;&#12471;&#12519;&#12531;&#24773;&#22577;&#27083;&#31689;</span>
        <span class="org-type">TextureRegion</span>[] <span class="org-variable-name">split</span> = <span class="org-keyword">new</span> <span class="org-type">TextureRegion</span>(img).split(16, 16)[0];
        <span class="org-type">TextureRegion</span>[] <span class="org-variable-name">mirror</span> = <span class="org-keyword">new</span> <span class="org-type">TextureRegion</span>(img).split(16, 16)[0];
        <span class="org-keyword">for</span> (<span class="org-type">TextureRegion</span> <span class="org-variable-name">region</span> : mirror)
            region.flip(<span class="org-constant">true</span>, <span class="org-constant">false</span>);
        animRight = <span class="org-keyword">new</span> <span class="org-type">Animation</span>(0.1f, split[2], split[3], split[4]);
        animLeft = <span class="org-keyword">new</span> <span class="org-type">Animation</span>(0.1f,  mirror[2], mirror[3], mirror[4]);
        animIdleRight = <span class="org-keyword">new</span> <span class="org-type">Animation</span>(0.5f, split[0], split[1]);
        animIdleLeft = <span class="org-keyword">new</span> <span class="org-type">Animation</span>(0.5f, mirror[0], mirror[1]);
        stateTime = 0;

        <span class="org-comment-delimiter">// </span><span class="org-comment">&#31227;&#21205;&#12508;&#12479;&#12531;</span>
        leftButton = <span class="org-keyword">new</span> <span class="org-type">Sprite</span>(img, 0, 16*2, 16*3, 16*2);
        rightButton = <span class="org-keyword">new</span> <span class="org-type">Sprite</span>(img, 16*3, 16*2, 16*3, 16*2);
        leftButton.setPosition(8, 0);
        rightButton.setPosition(8 + 16*3, 0);

        <span class="org-comment-delimiter">// </span><span class="org-comment">&#12525;&#12464;&#24773;&#22577;&#21462;&#24471;</span>
        Gdx.app.setLogLevel(<span class="org-constant">Application</span>.LOG_DEBUG);
    }
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">resize</span>(<span class="org-type">int</span> <span class="org-variable-name">width</span>, <span class="org-type">int</span> <span class="org-variable-name">height</span>) {
        Gdx.app.log(LOG_TAG, <span class="org-string">"risize"</span>);
        viewport.update(width, height);
        uiViewport.update(width, height);
    }

    <span class="org-keyword">private</span> <span class="org-type">void</span> <span class="org-function-name">reset</span>() {
        pos.set(0, 0);
    }

    <span class="org-keyword">private</span> <span class="org-type">void</span> <span class="org-function-name">left</span>() {
        dir = DIR_LEFT;
        state = STATE_MOVE;
        pos.x -= MOVE_SPEED;
    }

    <span class="org-keyword">private</span> <span class="org-type">void</span> <span class="org-function-name">right</span>() {
        dir = DIR_RIGHT;
        state = STATE_MOVE;
        pos.x += MOVE_SPEED;
    }

    <span class="org-keyword">private</span> <span class="org-type">Animation</span> <span class="org-function-name">currentAnim</span>() {
        <span class="org-type">Animation</span> <span class="org-variable-name">anim</span> = <span class="org-constant">null</span>;
        <span class="org-keyword">if</span> (state == STATE_MOVE) {
            <span class="org-keyword">if</span> (dir == DIR_LEFT) {
                anim = animLeft;
            } <span class="org-keyword">else</span> {
                anim = animRight;
            }
        } <span class="org-keyword">else</span> {
            <span class="org-keyword">if</span> (dir == DIR_LEFT) {
                anim = animIdleLeft;
            } <span class="org-keyword">else</span> {
                anim = animIdleRight;
            }
        }
        <span class="org-keyword">return</span> anim;
    }

    <span class="org-keyword">private</span> <span class="org-type">void</span> <span class="org-function-name">update</span>() {
        <span class="org-type">float</span> <span class="org-variable-name">deltaTime</span> = Gdx.graphics.getDeltaTime();
        <span class="org-keyword">if</span> (Gdx.input.isKeyPressed(<span class="org-constant">Input</span>.<span class="org-constant">Keys</span>.R)) {
            reset();
        }
        state = STATE_IDLE;
        leftButton.setColor(<span class="org-constant">Color</span>.WHITE);
        rightButton.setColor(<span class="org-constant">Color</span>.WHITE);
        <span class="org-keyword">if</span> (Gdx.input.isTouched()) {
            <span class="org-type">float</span> <span class="org-variable-name">x</span> = Gdx.input.getX();
            <span class="org-type">float</span> <span class="org-variable-name">y</span> = Gdx.input.getY();
            uiViewport.unproject(touchPoint.set(x, y, 0));
            <span class="org-type">Rectangle</span> <span class="org-variable-name">leftBounds</span> = leftButton.getBoundingRectangle();
            <span class="org-type">Rectangle</span> <span class="org-variable-name">rightBounds</span> = rightButton.getBoundingRectangle();

            <span class="org-comment-delimiter">// </span><span class="org-comment">&#12467;&#12513;&#12531;&#12488;&#12434;&#22806;&#12379;&#12400;&#12289;&#12508;&#12479;&#12531;&#12398;&#30697;&#24418;&#24773;&#22577;&#12289;&#12479;&#12483;&#12481;&#24231;&#27161;&#12394;&#12393;&#12364;&#24471;&#12425;&#12428;&#12427;&#12290;</span>
            <span class="org-comment-delimiter">// </span><span class="org-comment">String s0 = String.format("rawTouch(%f,%f)", x, y );</span>
            <span class="org-comment-delimiter">// </span><span class="org-comment">String s1 = String.format("leftBoudns(%f,%f,%f,%f)",</span>
            <span class="org-comment-delimiter">//                           </span><span class="org-comment">leftBounds.x,</span>
            <span class="org-comment-delimiter">//                           </span><span class="org-comment">leftBounds.y,</span>
            <span class="org-comment-delimiter">//                           </span><span class="org-comment">leftBounds.width,</span>
            <span class="org-comment-delimiter">//                           </span><span class="org-comment">leftBounds.height);</span>
            <span class="org-comment-delimiter">// </span><span class="org-comment">Gdx.app.log(LOG_TAG, s0);</span>
            <span class="org-comment-delimiter">// </span><span class="org-comment">Gdx.app.log(LOG_TAG, s1);</span>
            <span class="org-comment-delimiter">// </span><span class="org-comment">Gdx.app.log(LOG_TAG, "touchPoint(" + touchPoint.x + "," + touchPoint.y + ")");</span>

            <span class="org-keyword">if</span> (leftBounds.contains(touchPoint.x, touchPoint.y)) {
                left();
                <span class="org-comment-delimiter">//</span><span class="org-comment">Gdx.app.log(LOG_TAG, "left!");</span>
                leftButton.setColor(<span class="org-constant">Color</span>.GRAY);
            } <span class="org-keyword">else</span> <span class="org-keyword">if</span> (rightBounds.contains(touchPoint.x, touchPoint.y)) {
                right();
                <span class="org-comment-delimiter">//</span><span class="org-comment">Gdx.app.log(LOG_TAG, "right!");</span>
                rightButton.setColor(<span class="org-constant">Color</span>.GRAY);
            }
        }
        <span class="org-comment-delimiter">//</span><span class="org-comment">String info = String.format("fish pos(%f,%f)", fishpos.x, fishpos.y);</span>

        stateTime += deltaTime;

        <span class="org-comment-delimiter">// </span><span class="org-comment">&#12467;&#12513;&#12531;&#12488;&#12434;&#22806;&#12377;&#12392;&#12289;UV&#12473;&#12463;&#12525;&#12540;&#12523;&#12364;&#35211;&#12428;&#12427;&#12290;</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">bg.setU(scrollCounter);</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">bg.setV(scrollCounter);</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">bg.setU2(scrollCounter + 5.0f);</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">bg.setV2(scrollCounter + 5.0f);</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">scrollCounter += 0.05f;</span>
        <span class="org-comment-delimiter">// </span><span class="org-comment">if (scrollCounter &gt; 5.0f)</span>
        <span class="org-comment-delimiter">//     </span><span class="org-comment">scrollCounter = 0.0f;</span>
    }

    <span class="org-keyword">private</span> <span class="org-type">void</span> <span class="org-function-name">draw</span>() {
        Gdx.gl.glClearColor(0, 0, 1, 1);
        Gdx.gl.glClear(<span class="org-constant">GL20</span>.GL_COLOR_BUFFER_BIT);

        <span class="org-comment-delimiter">// </span><span class="org-comment">BG&#12459;&#12513;&#12521;&#12475;&#12483;&#12488;&#12450;&#12483;&#12503;</span>
        uiCamera.update();
        batch.setProjectionMatrix(uiCamera.combined);
        batch.begin();
        bg.draw(batch);
        batch.end();

        <span class="org-comment-delimiter">// </span><span class="org-comment">&#12466;&#12540;&#12512;&#12459;&#12513;&#12521;&#12475;&#12483;&#12488;&#12450;&#12483;&#12503;</span>
        camera.update();
        batch.setProjectionMatrix(camera.combined);

        batch.begin();

        <span class="org-comment-delimiter">// </span><span class="org-comment">&#12493;&#12467;&#12398;&#25551;&#30011;</span>
        <span class="org-type">boolean</span> <span class="org-variable-name">loop</span> = <span class="org-constant">true</span>;
        <span class="org-type">float</span> <span class="org-variable-name">width</span> = 16;
        <span class="org-type">float</span> <span class="org-variable-name">height</span> = 16;
        <span class="org-type">Animation</span> <span class="org-variable-name">nekoAnim</span> = currentAnim();
        batch.draw(nekoAnim.getKeyFrame(stateTime, loop),
                   pos.x, pos.y,
                   width, height);
        batch.end();

        <span class="org-comment-delimiter">// </span><span class="org-comment">&#12527;&#12540;&#12523;&#12489;&#24231;&#27161;&#36600;&#12434;&#25551;&#30011;&#12377;&#12427;&#12290;</span>
        shapeRenderer.setProjectionMatrix(camera.combined);
        shapeRenderer.begin(<span class="org-constant">ShapeRenderer</span>.<span class="org-constant">ShapeType</span>.Line);
        shapeRenderer.setColor(1, 0, 0, 1);
        shapeRenderer.line(-1024, 0, 1024, 0);
        shapeRenderer.setColor(0, 1, 0, 1);
        shapeRenderer.line(0, -1024, 0, 1024);
        shapeRenderer.end();

        <span class="org-comment-delimiter">// </span><span class="org-comment">&#12466;&#12540;&#12512;&#12459;&#12513;&#12521;&#12475;&#12483;&#12488;&#12450;&#12483;&#12503;</span>
        uiCamera.update();
        batch.setProjectionMatrix(uiCamera.combined);

        <span class="org-comment-delimiter">// </span><span class="org-comment">UI&#12398;&#25551;&#30011;</span>
        batch.begin();
        leftButton.draw(batch);
        rightButton.draw(batch);
        <span class="org-comment-delimiter">//</span><span class="org-comment">font.draw(batch, info, 0, 40);</span>

        batch.end();
    }

    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">render</span> () {
        update();
        draw();
    }

    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">dispose</span>() {
        music.dispose();
        batch.dispose();
        font.dispose();
        img.dispose();
        bgImg.dispose();
        shapeRenderer.dispose();
    }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> 今回の記事のアセット一覧</h2>
<div class="outline-text-2" id="text-7">
<p>
プログラムを動かす前に、テクスチャやBGMをダウンロードして、
下記に配置してください。
</p>
<div class="org-src-container">

<pre class="src src-sh">${<span class="org-variable-name">PROJECT_ROOT</span>}/android/assets/
</pre>
</div>
</div>
<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> テクスチャ</h3>
<div class="outline-text-3" id="text-7-1">

<div class="figure">
<p><img src="http://mikio.github.io/img/libgdx-beginner/3/neko.png" alt="neko.png" />
</p>
<p><span class="figure-number">Figure 5:</span> ねこの画像</p>
</div>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> 背景</h3>
<div class="outline-text-3" id="text-7-2">

<div class="figure">
<p><img src="http://mikio.github.io/img/libgdx-beginner/3/bg.png" alt="bg.png" />
</p>
<p><span class="figure-number">Figure 6:</span> 背景</p>
</div>
</div>
</div>

<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3"><span class="section-number-3">7.3</span> BGM</h3>
<div class="outline-text-3" id="text-7-3">
<ul class="org-ul">
<li><a href="http://mikio.github.com/demo/sound/mixdown.mp3">http://mikio.github.com/demo/sound/mixdown.mp3</a>
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> おわりに</h2>
<div class="outline-text-2" id="text-8">
<p>
今回は、ログ出力とスプライトアニメーション、そしてバーチャルパッドの方法を学びました。
次回は、画面遷移について解説します。
もしかしたら、ゲームっぽいものに仕上げるかも知れないです。
</p>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> 変更履歴</h2>
<div class="outline-text-2" id="text-9">
<ul class="org-ul">
<li>ターゲット解像度を変更(256x192 =&gt; 256x144)
</li>
<li>背景の画像を変更し、テクスチャラップ導入
</li>
<li>ボタンの画像を変更し、よりボタンらしい挙動をするようにした
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> 参考書籍</h2>
<div class="outline-text-2" id="text-10">
<div class="figure" style="float:left">
<a href="http://www.amazon.co.jp/gp/product/4844331132/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4844331132&linkCode=as2&tag=ocha04-22"><img border="0" src="http://ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=4844331132&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=ocha04-22" ></a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=ocha04-22&l=as2&o=9&a=4844331132" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
</div>
<p>
libGDXの作者が書いた本です。Androidでゲームを作るための基本を独自のフレームワーク作成を通して解説しています。
libGDXの解説ではないけれど、その思想は当然libGDXにも引き継がれています。もちろんlibGDXの理解もしやすくなります。
また、Androidの本ではありますが、スマホに特化した内容ばかりではなく、
どんなゲーム開発にも通用しそうな内容ばかりです。
実践的かつ基本的で自分は退屈せずに読めました(特にMVCについての言及が良い)。
そういう意味でこの本は、すべての初級ゲーム開発者におすすめできる本かと思います。
ただし一部内容が古いので注意してください(沢山売れて第2版が翻訳されればいいんですが)。
それでもlibGDXをやるなら読んでいて損はないと思います。
</p>
<div style="clear:both;"></div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p class="footpara">
libGDXが使用しているOpenGLでは、すべての2次元座標系は左下が原点となるのが原則のようです。
libGDXが左下が原点なのものこの仕様に影響されているものと思われます。
UVも実は左下が原点なのですが、VRAMへ転送する際に上下が反転されるらしく、
結果的に左上が原点となるようです。
</p></div>


</div>
</div>
  <footer class="article-footer">
    <nav class="social-buttons">
      <ul>
        <li class="twitter">
          <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
          <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </li>
        <li class="hatebu">
          <a href="http://b.hatena.ne.jp/entry/"
             class="hatena-bookmark-button"
             data-hatena-bookmark-layout="standard-balloon"
             data-hatena-bookmark-lang="ja"
             data-hatena-bookmark-title="libGDX入門 その3 ログ出力とアニメーションとバーチャルパッド"
             title="このエントリーをはてなブックマークに追加">
            <img src="http://b.st-hatena.com/images/entry-button/button-only@2x.png"
                 alt="このエントリーをはてなブックマークに追加"
                 width="20" height="20" style="border: none;" /></a>
            <script type="text/javascript"
                    src="http://b.st-hatena.com/js/bookmark_button.js"
                    charset="utf-8" async="async"></script>
        </li>
        <li class="pocket">
          <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="en"></a>
          <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
        </li>
      </ul>
    </nav>
    <nav class="tag">
      <ul>
                <li><span><a href="/tag/libGDX.html">libGDX</a></span></li>
                <li><span><a href="/tag/libGDX入門.html">libGDX入門</a></span></li>
        
      </ul>
    </nav>
    <nav>
      <ul class="pager">
                <li class="prev"><a href="/article/2014/06/20_apt-cyg-bug.html">&laquo;&nbsp;apt-cygがうまくいかなくなった。</a></li>
        
        &nbsp;&nbsp;
                <li class="next"><a href="/article/2014/06/02_libgdx-beginner2.html">libGDX入門 その2 カメラとビューポート&nbsp;&raquo;</a></li>
        
      </ul>
    </nav>
  </footer>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
   /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
   var disqus_shortname = 'mikiokunblog';

   /* * * DON'T EDIT BELOW THIS LINE * * */
   (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

                <script type="text/javascript" src="/js/main.js"></script>
        
        <script type="text/javascript">

         var _gaq = _gaq || [];
         _gaq.push(['_setAccount', 'UA-30203998-1']);
         _gaq.push(['_trackPageview']);

         (function() {
           var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
           ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
           var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
         })();

        </script>
      </div>
    </div>

    <div class="footer">
      <div class="misaki-logo">
        <p>
          <a href="https://github.com/mikio/misaki-orgmode" title="generated by Misaki orgmode">
            <img src="/img/misaki-orgmode-large-banner.png"/></a>
        </p>
        <p>Based on <a href="https://github.com/liquidz/misaki">Miaski</a>.</p>
        <p>This site is built with <a href="http://purecss.io">Pure</a> CSS Framework.</p>
        <p><a href="http://twitter.com/mikio_kun">@mikio_kun</a> 2014</p>
      </div>
    </div>
  </body>
</html>