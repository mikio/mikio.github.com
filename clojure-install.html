<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
lang="ja" xml:lang="ja">
<head>
<title>clojure-install</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2011-11-12 19:20:44 "/>
<meta name="author" content=""/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="org.css">
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">

<h1 class="title">clojure-install</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">はじめに </a></li>
<li><a href="#sec-2">Leiningenのインストール </a></li>
<li><a href="#sec-3">SLIMEとは </a></li>
<li><a href="#sec-4">Marmaladeのインストール </a></li>
<li><a href="#sec-5">SLIMEのインストール </a></li>
<li><a href="#sec-6">swank-clojureのインストール </a></li>
<li><a href="#sec-7">SLIMEの使い方 </a></li>
<li><a href="#sec-8">windowsで日本語を扱う場合 </a></li>
<li><a href="#sec-9">参考書籍 </a></li>
<li><a href="#sec-10">注釈 </a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">はじめに </h2>
<div class="outline-text-2" id="text-1">

<p>この記事は、自分がClojureで開発環境を準備するために調べたことをまとめています。
</p>
<ul>
<li>
対象読者
<ul>
<li>
Clojureに興味あるけど始め方がわからんという人。
</li>
<li>
素のREPLでClojureしてるけど使いにくいと感じてる人。
</li>
<li>
普段Emacs使ってるけど、SLIME?なにそれ？って人。

</li>
</ul>
</li>
<li>
推定環境
<ul>
<li>
Java6
</li>
<li>
emacs23
</li>
<li>
lein
</li>
<li>
slime

</li>
</ul>
</li>
</ul>

<p>OSは、Ubuntu10.04とwindows7, windowsxpで動作確認しています。
</p>
<p>
Clojureのインストールは、ビルドツールのLeiningenを使えばとっても簡単です。
Leiningenとは、Clojure用のビルドツールで、JavaでいうMavenみたいなものです。
プロジェクトのフォルダのひな形や、コンパイル、ライブラリの管理をしてくれます。
</p>
<p>
普通に考えると、Clojure本体をインストールして、ライブラリのクラスパスを通して、
起動コマンドを設定してなど、いろいろと手間をかけてやっと動くようになるもんですが、
Leiningenは、leinというシェルスクリプトをパスの通った場所におくだけで、インストールが完了しちゃいます。
あとは、指定のコマンドを叩くだけで、leinスクリプト自体がLeiningen本体はもちろんClojure本体もダウンロードしてくれます
（Java本体だけは予め入れておく必要がありますが）。
</p>
<p>
ちなみに読み方は「ライニゲン」だそうです。自分はいつも「れい人間」と読んでますｗ。
</p><ul>
<li>
<a href="http://d.hatena.ne.jp/masa_edw/20100508/1273284275">http://d.hatena.ne.jp/masa_edw/20100508/1273284275</a>


</li>
</ul>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Leiningenのインストール </h2>
<div class="outline-text-2" id="text-2">

<p>まずはJavaの最新版をインストールしちゃいましょう
(現時点ではJavaSE7はいろいろ不安定なのでJava6をお勧めします)。
</p><ul>
<li>
<a href="http://java.com/ja/download/manual.jsp">http://java.com/ja/download/manual.jsp</a>

</li>
</ul>

<p>続いて下記サイトからLeiningenのアーカイブを取ってきます。
</p><ul>
<li>
<a href="https://github.com/technomancy/leiningen">https://github.com/technomancy/leiningen</a>

</li>
</ul>

<p>直リンは以下。
</p><ul>
<li>
<a href="https://github.com/downloads/technomancy/leiningen/leiningen-1.5.2-win.zip">https://github.com/downloads/technomancy/leiningen/leiningen-1.5.2-win.zip</a>


</li>
</ul>

<p>解凍したらできたフォルダをPATHに通します。
自分の場合は%HOME%\binというディレクトリにleinフォルダの中身(windwosの場合は、lein.batとwget.exe、linuxの場合は、lein)をコピーしました。
</p>


<pre class="src src-sh">$ cd %HOME%
$ mkdir bin
</pre>




<p>
Windwosの環境変数だとこんな感じ。
</p>


<pre class="src src-sh"><span class="org-variable-name">JAVA_HOME</span>=C:\Program Files\Java\jdk1.6.0_24
<span class="org-variable-name">PATH</span>=%PATH%;%HOME%\bin;%JAVA_HOME%\bin;
</pre>




<p>
linuxの場合は実行権を付与しておきます。
</p>


<pre class="src src-sh">$ chmod +x lein 
</pre>




<p>
パスが通ってるのを確認したら以下でインストール開始。
</p>


<pre class="src src-sh">$ lein self-install
</pre>



<p>
これで最新版のClojureも含めてLeiningenがインストールされます。
</p>



<pre class="src src-sh">$ lein
Leiningen is a build tool for Clojure.
 :
 :
</pre>




<p>
replを起動してインストールされたことを確認します。
</p>


<pre class="src src-sh">$ lein repl
</pre>



<p>
C-cで終了です。
</p>

</div>

<div id="outline-container-2.1" class="outline-3">
<h3 id="sec-2.1">簡単な使い方。 </h3>
<div class="outline-text-3" id="text-2.1">

<p>プロジェクト作成
</p>


<pre class="src src-sh">$ cd ~/dev
$ lein new myproject
$ cd myproject
</pre>




<p>
依存関係の解決
</p>


<pre class="src src-sh">$ lein deps
</pre>




<p>
プロジェクトのパッケージング
</p>


<pre class="src src-sh">$ lein jar
</pre>





</div>

</div>

<div id="outline-container-2.2" class="outline-3">
<h3 id="sec-2.2">Leiningenの次は </h3>
<div class="outline-text-3" id="text-2.2">

<p>Leiningenがあれば、replも起動できるし、あとはテキストエディタさえあれば開発ができます。
極端な話、メモ帳とDOS窓、Linuxだったら端末とviさえあれば開発できるということです。
</p>
<p>
とはいえ、今時メモ帳で開発なんてありえません。メモ帳や(素の)viではカッコの対応がすぐ崩れてしまいます。
vimや高性能エディタを使えばそれなりに快適な環境が構築できるかもしれませんが、ほとんどLispで書かれているEmacsにはかないません。<sup><a class="footref" name="fnr.1" href="#fn.1">1</a></sup>
この際カッコでできたEmacsを使っちゃいましょうw。
</p>
<p>
てことで、Emacs用のIDEであるSLIMEという統合開発環境をインストールします。
</p>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">SLIMEとは </h2>
<div class="outline-text-2" id="text-3">


<p>
Emacsには有名な（というかLispのデファクトスタンダードである）SLIMEという開発環境があります。<sup><a class="footref" name="fnr.2" href="#fn.2">2</a></sup>
</p>


<pre class="src src-sh">SLIME is the Superior Lisp Interaction Mode for Emacs. 
</pre>



<p>
直訳すると「SLIMEはEmacs向けの優れたlisp対話モードです」ですね。
</p>
<p>
SLIMEの特徴は以下に詳しいですが、
</p><ul>
<li>
<a href="http://lispuser.net/emacs/lisphacking.html#sec-2.1">http://lispuser.net/emacs/lisphacking.html#sec-2.1</a>
</li>
</ul>

<p>簡単にまとめると
</p><ul>
<li>
デバッガやシンボルの補完
</li>
<li>
関数の引数表示やドキュメントへの簡単アクセス
</li>
<li>
処理系ごとに違うREPLの差を吸収したUIの提供
</li>
</ul>

<p>などがあります。
</p>
<p>
ほかにClojureでSLIMEをつかうメリットとして、スクリプト起動で待たされることがないということがあります。
ClojureはJVMベース故に起動がとても重いので、他のスクリプト言語のようにサクッと起動してちゃちゃっと処理するのが苦手ですが、
SLIMEで開発すればそのようなことはなく、即実行ができるので快適に使えると思います。Linuxなどでいう端末みたいな役割を果たすということですかね。
このように便利なSLIMEですから、多くのLisperはカッコが好きというよりもSLIMEの操作性の虜になってるのではないかっなって思います。
</p>
<p>
私は最初、LISPの処理系であればなんでもSLIMEが使えるものと勝手に勘違いしていたのですが、
SLIMEはもともとCommonLisp用に開発されたもので、当初はCommonLisp以外の環境はサポートされていなかったようです。
例えばGaucheは、もともとSLIMEに対応していなくて、2009年に最初のバージョンができたようです。意外ですね。
</p>
<p>
ClojureでSLIMEを利用するには以下のインストールが必要です。<sup><a class="footref" name="fnr.3" href="#fn.3">3</a></sup>
</p>
<ul>
<li>
SLIME(SLIME本体、SLIME-REPL)
</li>
<li>
SWANKサーバー(swank-clojure)
</li>
<li>
Clojure-mode

</li>
</ul>

<p>SWANKサーバーとは、SLIMEとLisp処理系を橋渡しするサーバーです。
このSWANKサーバのおかげでClojureでもSLIMEを利用できるわけです。
</p>
<p>
これらのモジュールは、それぞれ手動でインストールしても良いのですが、
SLIMEとClojure-modeに関しては、最近Emacs界隈で有名なMarmaladeを利用すると簡単です。
MarmaladeはEmacsように開発されたパッケージシステムで簡単にEmacs用ソフトをインストールできます。
次はMarmaladeのインストールを説明します。
</p>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">Marmaladeのインストール </h2>
<div class="outline-text-2" id="text-4">


<p>
ほとんど下記にある説明のとおりですが
</p><ul>
<li>
<a href="http://sheephead.homelinux.org/2011/06/17/6724/">http://sheephead.homelinux.org/2011/06/17/6724/</a>

</li>
</ul>

<p>Marmaladeとは次期Emacs24でサポートされているパッケージ管理サイトで
Emacs24からは標準で利用できるらしいです。
</p>
<p>
インストール方法も上記サイトからのパクリですが
</p>
<p>
下記を実行して
</p>


<pre class="src src-emacs-lisp">(install-elisp <span class="org-string">"http://repo.or.cz/w/emacs.git/blob_plain/1a0a666f941c99882093d7bd08ced15033bc3f0c:/lisp/emacs-lisp/package.el"</span>)
</pre>




<p>
下記を.emacsに設定すればインストール完了です。
</p>


<pre class="src src-elisp">(<span class="org-keyword">require</span> '<span class="org-constant">package</span>)

<span class="org-comment-delimiter">;;</span><span class="org-comment">&#12522;&#12509;&#12472;&#12488;&#12522;&#12395;Marmalade&#12434;&#36861;&#21152;
</span>(add-to-list 'package-archives '(<span class="org-string">"marmalade"</span> . <span class="org-string">"http://marmalade-repo.org/packages/"</span>))

<span class="org-comment-delimiter">;;</span><span class="org-comment">&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12377;&#12427;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12434;&#25351;&#23450;
</span>(setq package-user-dir (concat user-emacs-directory <span class="org-string">"vendor/elpa"</span>))

<span class="org-comment-delimiter">;;</span><span class="org-comment">&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12375;&#12383;&#12497;&#12483;&#12465;&#12540;&#12472;&#12395;&#12525;&#12540;&#12489;&#12497;&#12473;&#12434;&#36890;&#12375;&#12390;&#12525;&#12540;&#12489;&#12377;&#12427;
</span>(package-initialize)
</pre>




<p>
これでパッケージを簡単にインストールできるようになりました。
</p>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5">SLIMEのインストール </h2>
<div class="outline-text-2" id="text-5">

<p>Marmaladeからインストールします。
</p>


<pre class="src src-sh">M-x package-install
</pre>



<p>
下記をiで選択し、xで実行してください。
</p><ul>
<li>
slime
</li>
<li>
slime-repl
</li>
<li>
clojure-mode
</li>
</ul>

<p>SLIME自身は、SLIME本体とSLIME-REPLという2部構成になっているっぽいです。
また、Clojure-modeはSLIMEと直接関係ありませんが、ついでにインストールしておきます。
</p>
<p>
設定は以下になります。
</p>


<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">slime</span>)
(setq slime-net-coding-system 'utf-8-unix
      slime-protocol-version 'ignore)
(slime-setup '(slime-repl))

(<span class="org-keyword">require</span> '<span class="org-constant">clojure-mode</span>)
(add-hook 'slime-repl-mode-hook (<span class="org-keyword">lambda</span> () (clojure-mode-font-lock-setup)))
</pre>



<p>
自分の場合、下記のようにslime-fancy, slime-bannerを指定すると動きませんでした。
</p>


<pre class="src src-emacs-lisp">(slime-setup '(slime-repl slime-fancy slime-banner))
</pre>



<p>
続いてSWANKサーバーをインストールします。
</p>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6">swank-clojureのインストール </h2>
<div class="outline-text-2" id="text-6">

<p>Clojure用のswankサーバーは、Leiningenのプラグインとしてインストールします。
</p>


<pre class="src src-sh">$ lein plugin install swank-clojure 1.3.3
</pre>




<p>
下記でswankサーバーを起動できます。
</p>


<pre class="src src-sh">$ cd ~/dev/project
$ lein swank
</pre>



<p>
この方法では、Projectディレクトリに移動してから起動しますが、
こうすることにより、必要なクラスパスが設定された状態でSWANKサーバーが起動されます。
</p>
<p>
下記は、プロジェクトを指定しない起動方法です。
</p>


<pre class="src src-sh">$ ~/.lein/bin/swank-clojure
</pre>



<p>
この場合、クラスパスの指定がないので、clojure.coreの関数ぐらいしか使えません。
</p>

</div>

<div id="outline-container-6.1" class="outline-3">
<h3 id="sec-6.1">参考 </h3>
<div class="outline-text-3" id="text-6.1">

<p><a href="https://github.com/technomancy/swank-clojure">https://github.com/technomancy/swank-clojure</a>
</p>

</div>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7">SLIMEの使い方 </h2>
<div class="outline-text-2" id="text-7">

<p>ここまでで、Leiningen, SLIME, SWANK-Clojure, Clojure-modeをインストールしてきました。
最後にこれらの使い方をまとめます。
</p>

</div>

<div id="outline-container-7.1" class="outline-3">
<h3 id="sec-7.1">REPLサーバ起動 </h3>
<div class="outline-text-3" id="text-7.1">

<p>依存するクラスライブラリが設定された状態で起動します。
</p>


<pre class="src src-sh">$ cd myproject
$ lein swank
</pre>




</div>

</div>

<div id="outline-container-7.2" class="outline-3">
<h3 id="sec-7.2">接続 </h3>
<div class="outline-text-3" id="text-7.2">

<p>SWNAKサーバーを起動した状態で、
</p>


<pre class="src src-sh">M-x slime-connect
localhost:4005
</pre>



<p>
とします。
</p>
</div>

</div>

<div id="outline-container-7.3" class="outline-3">
<h3 id="sec-7.3">操作方法 </h3>
<div class="outline-text-3" id="text-7.3">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<tbody>
<tr><td>C-c C-c</td><td>カーソル位置のコードのコンパイル</td></tr>
<tr><td>C-c C-z</td><td>REPLバッファの表示</td></tr>
<tr><td>C-c C-k</td><td>ファイル全体のコンパイル</td></tr>
<tr><td>M-.</td><td>定義にジャンプ</td></tr>
<tr><td>M-,</td><td>元の定義に戻る</td></tr>
<tr><td>M-r</td><td>正規表現で履歴検索</td></tr>
</tbody>
</table>



</div>

</div>

<div id="outline-container-7.4" class="outline-3">
<h3 id="sec-7.4">参考URL </h3>
<div class="outline-text-3" id="text-7.4">

<p>SLIMEの操作方法については、下記が非常に参考になりました。
</p><ul>
<li>
<a href="http://modern-cl.blogspot.com/2011/07/5-slime.html">http://modern-cl.blogspot.com/2011/07/5-slime.html</a>
</li>
</ul>

<p>このサイトでも解説されていますが、ACモードやPopwinも入れたほうが格段に操作方法がよくなります。
</p>
</div>
</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8">windowsで日本語を扱う場合 </h2>
<div class="outline-text-2" id="text-8">

<p>Windowsからlein swankで起動したswankサーバと連携する場合
SLIME-REPL上で日本語を評価すると、サーバーが停止してしまいます。
これを回避するには、lein.batの先頭で下記を追記しておきます。
</p>


<pre class="src src-sh"><span class="org-builtin">set</span> <span class="org-variable-name">JAVA_OPTS</span>=-Dswank.encoding=utf-8-unix
</pre>





</div>

<div id="outline-container-8.1" class="outline-3">
<h3 id="sec-8.1">参考URL </h3>
<div class="outline-text-3" id="text-8.1">

<p><a href="http://rd.clojure-users.org/entry/view/52001">http://rd.clojure-users.org/entry/view/52001</a>
</p>


</div>
</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9">参考書籍 </h2>
<div class="outline-text-2" id="text-9">


</div>

</div>

<div id="outline-container-10" class="outline-2">
<h2 id="sec-10">注釈 </h2>
<div class="outline-text-2" id="text-10">






</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn.1" href="#fnr.1">1</a></sup> こんなこというとVimmerから非難されてしまいますがｗ。
</p>
<p class="footnote"><sup><a class="footnum" name="fn.2" href="#fnr.2">2</a></sup> SLIMEは、最近ではvimやeclipseからも利用できるようです。普及すればEmacsにこだわる必要はないかもですね。ライトユーザにはEclipseはよさそうです。
</p>
<p class="footnote"><sup><a class="footnum" name="fn.3" href="#fnr.3">3</a></sup> ちなみに普段emacsを使ってない人は、<a href="http://clojure.bighugh.com">ClojureBox</a>をインストールするのが一番手っ取り早いです。
これは、Emacs+SLIME+CLojure、開発環境一式をすべてまるごとインストールしてくれる夢の様なプロダクトです。
Emacsはそれ自体の設定が大変煩雑なので、面倒が嫌いな人はこれをインストールすればOKかと思います。
</p>
</div>
</div>
<div id="postamble">
<p class="date"> Date: 2011-11-12 19:20:44 </p>
</div>
</div>
</body>
</html>
